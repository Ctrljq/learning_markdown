# ä¸€ã€çº¿æ®µè¡¨

â€‹	**çº¿æ®µæ ‘ æ˜¯è‘—åçš„ç”¨äºé«˜æ•ˆæ±‚è§£ ã€ŒåŒºé—´é—®é¢˜ã€ çš„æ•°æ®ç»“æ„ã€‚**ã€ŒåŒºé—´é—®é¢˜ã€å³å¯¹äºè¾“å…¥æ•°ç»„ nums ï¼Œåœ¨å…¶ä¸Šæ‰§è¡Œ ã€ŒåŒºé—´æ±‚å’Œã€ ã€ ã€ŒåŒºé—´ä¿®æ”¹ã€ ç­‰æ“ä½œï¼Œé€šå¸¸è¿˜ä¼´éšç€é’ˆå¯¹å•ä¸ªå…ƒç´ çš„ ã€Œå•ç‚¹æŸ¥è¯¢ã€ ã€ ã€Œå•ç‚¹ä¿®æ”¹ã€ è¿™ä¸¤ç§å•ç‚¹æ“ä½œã€‚è‹¥ç›´æ¥æ“ä½œ nums ï¼Œåˆ™å•ç‚¹æ“ä½œæ—¶é—´å¤æ‚åº¦ä¸º O(1) ï¼Œè€ŒåŒºé—´æ“ä½œä¸º O(n) ï¼›è‹¥é‡‡ç”¨ã€Œå‰ç¼€å’Œã€ï¼Œåˆ™åŒºé—´æ“ä½œä¸º O(1) ï¼Œè€Œå•ç‚¹æ“ä½œä¸º O(n) ã€‚åˆ©ç”¨å®Œå…¨äºŒå‰æ ‘ä¸‹æ ‡ç‰¹ç‚¹ (é™æ€å †å¼çº¿æ®µæ ‘) æˆ–åŠ¨æ€å¼€ç‚¹æ“ä½œ (åŠ¨æ€çº¿æ®µæ ‘)ï¼Œå°† nums ä¸Šå¯¹ä»»æ„å…ƒç´ å€¼æˆ–ä»»æ„åŒºé—´å€¼ (åŒºé—´æ±‚å’Œã€åŒºé—´æœ€å€¼ç­‰) çš„æ±‚è§£ï¼Œ**æ„å»ºåœ¨ä¸€æ£µäºŒå‰æ ‘ä¸Šï¼Œé€šè¿‡å¯¹è¯¥äºŒå‰æ ‘çš„åˆ†æ²»å¤„ç† (dfs) ï¼ŒåŒæ—¶å®ç° O(logn) æ—¶é—´å¤æ‚åº¦çš„å•ç‚¹æ“ä½œä¸åŒºé—´æ“ä½œ ã€‚**

å¸¸ç”¨çš„ç»“æ„ä½“å†…éƒ¨å˜é‡ï¼šsumï¼Œlazyï¼Œmaxï¼Œminï¼Œã€l, rï¼Œnodeidã€‘ï¼Œ==ä¹Ÿå¯ä»¥è®¾ç½®ä¸ºå¤–éƒ¨æ•°ç»„ã€‚ç”¨æ•°ç»„æ¨¡æ‹Ÿæ ‘èŠ‚ç‚¹ã€‚==

## 1ã€çº¿æ®µæ ‘çš„åŸºæœ¬ç»“æ„ã€å»ºæ ‘åŠåŒºé—´æŸ¥è¯¢

**ä¸æ¶‰åŠæ‡’æ ‡è®°**

```c++
void build(int s, int t, int p) {
  // å¯¹ [s,t] åŒºé—´å»ºç«‹çº¿æ®µæ ‘,å½“å‰æ ¹çš„ç¼–å·ä¸º p
 
}


void op1_Plus_x(int l,int r,int x,int s,int e,int id){
    if(s==e){
        a[id]+=x;
        return;
    }
    int mid=(s+e)/2;
    if(l<=mid){
        op1_Plus_x(l,r,x,s,mid,id*2);
    }
    if(r>mid){
        op1_Plus_x(l,r,x,mid+1,e,id*2+1);           //åœ¨è¾¹ç•Œæ—¶ï¼Œä¸¤ä¸ªifåªæ»¡è¶³ä¸€ä¸ªï¼Œæ‰§è¡Œäº†returnåï¼Œåˆ™é€€å‡ºåˆ°æœ€åèµ‹å€¼è¯­å¥
    }
    a[id]=a[id*2]+a[id*2+1];
}

  

int op2_GetSum(int l,int r,int s,int e,int id){
    if(l>e||r<s){
        return 0;
    }
    if(l<=s&&e<=r){
        // å½“å‰åŒºé—´ä¸ºè¯¢é—®åŒºé—´çš„å­é›†
        return a[id];
    }
    int mid=(s+e)/2;
    int sum=0;
    if(l<=mid)
        sum+=op2_GetSum(l,r,s,mid,id*2);
    if(r>mid)
        sum+=op2_GetSum(l,r,mid+1,e,id*2+1);
    return sum;
}
```

## 2ã€åŒºé—´ä¿®æ”¹ä¸æ‡’æƒ°æ ‡è®°

æ‡’æƒ°æ ‡è®°ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯é€šè¿‡å»¶è¿Ÿå¯¹èŠ‚ç‚¹ä¿¡æ¯çš„æ›´æ”¹ï¼Œä»è€Œå‡å°‘å¯èƒ½ä¸å¿…è¦çš„æ“ä½œæ¬¡æ•°ã€‚æ¯æ¬¡æ‰§è¡Œä¿®æ”¹æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡æ‰“æ ‡è®°çš„æ–¹æ³•è¡¨æ˜è¯¥èŠ‚ç‚¹å¯¹åº”çš„åŒºé—´åœ¨æŸä¸€æ¬¡æ“ä½œä¸­è¢«æ›´æ”¹ï¼Œä½†ä¸æ›´æ–°è¯¥èŠ‚ç‚¹çš„å­èŠ‚ç‚¹çš„ä¿¡æ¯ã€‚å®è´¨æ€§çš„ä¿®æ”¹åˆ™åœ¨ä¸‹ä¸€æ¬¡è®¿é—®å¸¦æœ‰æ ‡è®°çš„èŠ‚ç‚¹æ—¶æ‰è¿›è¡Œã€‚

```
ä¼˜ç‚¹
æŸ¥è¯¢å’Œæ›´æ–°é«˜æ•ˆï¼šçº¿æ®µæ ‘å¯ä»¥åœ¨O(logn) æ—¶é—´å†…å®ŒæˆåŒºé—´æŸ¥è¯¢å’Œå•ç‚¹æ›´æ–°ï¼Œæ•ˆç‡è¾ƒé«˜ã€‚
çµæ´»æ€§å¼ºï¼šçº¿æ®µæ ‘å¯ä»¥å¤„ç†å¤šç§ç±»å‹çš„åŒºé—´æ“ä½œï¼Œå¦‚åŒºé—´å’Œã€åŒºé—´æœ€å°å€¼ã€æœ€å¤§å€¼ç­‰ã€‚
é€‚åˆåŠ¨æ€æ“ä½œï¼šçº¿æ®µæ ‘å¯ä»¥é«˜æ•ˆåœ°å¤„ç†åŒºé—´çš„åŠ¨æ€ä¿®æ”¹ï¼Œå¦‚å•ç‚¹æ›´æ–°å’ŒåŒºé—´æ›´æ–°ã€‚
ç¼ºç‚¹ä¸å±€é™æ€§
å®ç°å¤æ‚ï¼šçº¿æ®µæ ‘çš„å®ç°ç›¸å¯¹å¤æ‚ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†åŒºé—´æ›´æ–°å’Œæ‡’æƒ°æ ‡è®°æ—¶ï¼Œéœ€è¦ä»”ç»†å¤„ç†ã€‚
ç©ºé—´å¤æ‚åº¦é«˜ï¼šçº¿æ®µæ ‘é€šå¸¸éœ€è¦O(4n) çš„ç©ºé—´ï¼Œè¿™å¯¹äºå­˜å‚¨ç©ºé—´æœ‰é™çš„ç³»ç»Ÿå¯èƒ½æ˜¯ä¸ªé—®é¢˜ã€‚
```



```c++
/*æ·»åŠ å€¼c*/
void op1_Plus_x(int l,int r,long long x,int s,int e,int id){
    if(l<=s&&e<=r){
        a[id]+=x*(e-s+1);
        lazy[id]+=x;
        return;
    }
    int mid=(s+e)/2;
    if(lazy[id]&&s!=e){
        lazy[id*2]+=lazy[id];
        lazy[id*2+1]+=lazy[id];           //æ‡’æ ‡è®°ä¼ é€’
        a[id*2]+=(mid-s+1)*lazy[id];
        a[id*2+1]+=(e-mid)*lazy[id];        //æ›´æ–°å­èŠ‚ç‚¹
        lazy[id]=0;                        //æ‡’æ ‡è®°ç½®0
    }
    if(l<=mid){
        op1_Plus_x(l,r,x,s,mid,id*2);
    }
    if(r>mid){
        op1_Plus_x(l,r,x,mid+1,e,id*2+1);
    }
    a[id]=a[id*2]+a[id*2+1];
}


/*åŒºé—´æ±‚å’Œ*/
long long op2_GetSum(int l,int r,int s,int e,int id){
    if(l<=s&&e<=r){
        // å½“å‰åŒºé—´ä¸ºè¯¢é—®åŒºé—´çš„å­é›†
        return a[id];
    }
    int mid=(s+e)/2;
    if(lazy[id]!=0&&s!=e){
        lazy[id*2]+=lazy[id];
        lazy[id*2+1]+=lazy[id];           //æ‡’æ ‡è®°ä¼ é€’
        a[id*2]+=(mid-s+1)*lazy[id];
        a[id*2+1]+=(e-mid)*lazy[id];  //æ›´æ–°å­èŠ‚ç‚¹
        lazy[id]=0;                        //æ‡’æ ‡è®°ç½®0
    }
    long long sum=0;
    if(l<=mid)
        sum+=op2_GetSum(l,r,s,mid,id*2);
    if(r>mid)
        sum+=op2_GetSum(l,r,mid+1,e,id*2+1);
    return sum;
}


/*ä¿®æ”¹ä¸ºæŸå€¼*/
void update(int l, int r, int c, int s, int t, int p) {
  if (l <= s && t <= r) {
    d[p] = (t - s + 1) * c, b[p] = c;
    return;
  }
  int m = s + ((t - s) >> 1);
  // é¢å¤–æ•°ç»„å‚¨å­˜æ˜¯å¦ä¿®æ”¹å€¼
  if (v[p]) {
    d[p * 2] = b[p] * (m - s + 1), d[p * 2 + 1] = b[p] * (t - m);
    b[p * 2] = b[p * 2 + 1] = b[p];
    v[p * 2] = v[p * 2 + 1] = 1;
    v[p] = 0;
  }
  if (l <= m) update(l, r, c, s, m, p * 2);
  if (r > m) update(l, r, c, m + 1, t, p * 2 + 1);
  d[p] = d[p * 2] + d[p * 2 + 1];
}

int getsum(int l, int r, int s, int t, int p) {
  if (l <= s && t <= r) return d[p];
  int m = s + ((t - s) >> 1);
  if (v[p]) {
    d[p * 2] = b[p] * (m - s + 1), d[p * 2 + 1] = b[p] * (t - m);
    b[p * 2] = b[p * 2 + 1] = b[p];
    v[p * 2] = v[p * 2 + 1] = 1;
    v[p] = 0;
  }
  int sum = 0;
  if (l <= m) sum = getsum(l, r, s, m, p * 2);
  if (r > m) sum += getsum(l, r, m + 1, t, p * 2 + 1);
  return sum;
}
```

## 3ã€å…³äºåŠ¨æ€å¼€çº¿æ®µæ ‘

ç”¨lså’Œlrè®°å½•å„¿å­çš„ç¼–å·ã€‚æ€»ä¹‹ï¼ŒåŠ¨æ€å¼€ç‚¹çº¿æ®µæ ‘çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯ï¼š**ç»“ç‚¹åªæœ‰åœ¨æœ‰éœ€è¦çš„æ—¶å€™æ‰è¢«åˆ›å»º**ã€‚

## 4ã€ä¾‹é¢˜

[[çº¿æ®µæ ‘åŸºç¡€æ¨¡ç‰ˆ]](C:\Users\HUAWEI\Desktop\code\lutece\Segment_tree.c)

# äºŒã€å¹¶æŸ¥é›†ï¼ˆä¸å›¾è¿é€šæœ‰å…³ï¼‰

## 1ã€åŸºæœ¬æ¦‚å¿µ

å¹¶æŸ¥é›†æ˜¯ä¸€ç§ç”¨äºç®¡ç†å…ƒç´ æ‰€å±é›†åˆçš„æ•°æ®ç»“æ„ï¼Œå®ç°ä¸ºä¸€ä¸ªæ£®æ—ï¼Œå…¶ä¸­æ¯æ£µæ ‘è¡¨ç¤ºä¸€ä¸ªé›†åˆï¼Œæ ‘ä¸­çš„èŠ‚ç‚¹è¡¨ç¤ºå¯¹åº”é›†åˆä¸­çš„å…ƒç´ ã€‚

 **åˆå§‹åŒ–**

<u>åˆå§‹æ—¶ï¼Œæ¯ä¸ªå…ƒç´ éƒ½ä½äºä¸€ä¸ªå•ç‹¬çš„é›†åˆï¼Œè¡¨ç¤ºä¸ºä¸€æ£µåªæœ‰æ ¹èŠ‚ç‚¹çš„æ ‘ã€‚æ–¹ä¾¿èµ·è§ï¼Œæˆ‘ä»¬å°†æ ¹èŠ‚ç‚¹çš„çˆ¶äº²è®¾ä¸ºè‡ªå·±ã€‚</u>

é¦–å…ˆæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªæ•°ç»„ï¼šint pre[1000]; ï¼ˆæ•°ç»„é•¿åº¦ä¾é¢˜æ„è€Œå®šï¼‰ã€‚è¿™ä¸ªæ•°ç»„è®°å½•äº†æ¯ä¸ªäººçš„ä¸Šçº§æ˜¯è°ã€‚è¿™äº›äººä»0æˆ–1å¼€å§‹ç¼–å·ï¼ˆä¾é¢˜æ„è€Œå®šï¼‰ã€‚æ¯”å¦‚è¯´pre[16]=6å°±è¡¨ç¤º16å·çš„ä¸Šçº§æ˜¯6å·ã€‚å¦‚æœä¸€ä¸ªäººçš„ä¸Šçº§å°±æ˜¯ä»–è‡ªå·±ï¼Œé‚£è¯´æ˜ä»–å°±æ˜¯æ•™ä¸»äº†

```c
int findSet(int x) 
{ 
     if (set[x] == -1) 
          return x;
     return findSet(set[x]); 
}

void unionSet(int x, int y)
 { 
      int fx = findSet(x); 
      int fy = findSet(y); 
      if (fx != fy)  
          set[fx] = fy; 
}
```

## 2ã€å‹ç¼©ä¸åˆå¹¶

### **a.è·¯å¾„å‹ç¼©**

<u>åœ¨æŸ¥æ‰¾æ—¶è¿›è¡Œå¤„ç†</u>

```c
int find(int x)     				//æŸ¥æ‰¾ç»“ç‚¹ xçš„æ ¹ç»“ç‚¹ 
{
    if(pre[x] == x) return x;		//é€’å½’å‡ºå£ï¼šxçš„ä¸Šçº§ä¸º xæœ¬èº«ï¼Œå³ xä¸ºæ ¹ç»“ç‚¹        
    return pre[x] = find(pre[x]);	//æ­¤ä»£ç ç›¸å½“äºå…ˆæ‰¾åˆ°æ ¹ç»“ç‚¹ rootxï¼Œç„¶åpre[x]=rootx 
}
```

è¯¥ç®—æ³•å­˜åœ¨ä¸€ä¸ªç¼ºé™·ï¼šåªæœ‰å½“æŸ¥æ‰¾äº†æŸä¸ªèŠ‚ç‚¹çš„ä»£è¡¨å…ƒï¼ˆæ•™ä¸»ï¼‰åï¼Œæ‰èƒ½å¯¹è¯¥æŸ¥æ‰¾è·¯å¾„ä¸Šçš„å„èŠ‚ç‚¹è¿›è¡Œè·¯å¾„å‹ç¼©ã€‚æ¢è¨€ä¹‹ï¼Œç¬¬ä¸€æ¬¡æ‰§è¡ŒæŸ¥æ‰¾æ“ä½œçš„æ—¶å€™æ˜¯å®ç°æ²¡æœ‰å‹ç¼©æ•ˆæœçš„ï¼Œåªæœ‰åœ¨ä¹‹åæ‰æœ‰æ•ˆã€‚

### **b.åŠ æƒå‹ç¼©ï¼ˆå¯å‘å¼åˆå¹¶ï¼‰**

<u>åœ¨åˆå¹¶æ—¶å¤„ç†</u>

```c
void union(int x,int y)
{
    x=find(x);							//å¯»æ‰¾ xçš„ä»£è¡¨å…ƒ
    y=find(y);							//å¯»æ‰¾ yçš„ä»£è¡¨å…ƒ
    if(x==y) return ;					//å¦‚æœ xå’Œ yçš„ä»£è¡¨å…ƒä¸€è‡´ï¼Œè¯´æ˜ä»–ä»¬å…±å±åŒä¸€é›†åˆï¼Œåˆ™ä¸éœ€è¦åˆå¹¶ï¼Œç›´æ¥è¿”å›ï¼›å¦åˆ™ï¼Œæ‰§è¡Œä¸‹é¢çš„é€»è¾‘
    if(rank[x]>rank[y]) pre[y]=x;		//å¦‚æœ xçš„é«˜åº¦å¤§äº yï¼Œåˆ™ä»¤ yçš„ä¸Šçº§ä¸º x
    else								//å¦åˆ™
    {
        if(rank[x]==rank[y]) rank[y]++;	//å¦‚æœ xçš„é«˜åº¦å’Œ yçš„é«˜åº¦ç›¸åŒï¼Œåˆ™ä»¤ yçš„é«˜åº¦åŠ 1
        pre[x]=y;						//è®© xçš„ä¸Šçº§ä¸º y
    }
}

```

## 3ã€ä¾‹é¢˜

### **a.æœ€å°ç”Ÿæˆæ ‘kruskalç®—æ³•**

<img src="C:/Users/HUAWEI/AppData/Roaming/Typora/typora-user-images/image-20240423210248923.png" alt="image-20240423210248923" style="zoom:50%;" />

```c
/*InputThe first line contains a number T denotes the number of test case. 
ç¬¬ä¸€è¡ŒåŒ…å«ä¸€ä¸ªæ•°å­—Tï¼Œè¡¨ç¤ºæµ‹è¯•ç”¨ä¾‹çš„æ•°é‡ã€‚
For each test case,In the first line, you will get two number N (1<=N<=1000) and M(1<=M<=N*N), denotes the number of towns and the number of roads. 
å¯¹äºæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œåœ¨ç¬¬ä¸€è¡Œä¸­ï¼Œæ‚¨å°†å¾—åˆ°ä¸¤ä¸ªæ•°å­—N  (1<=N<=1000)å’ŒM(1<=M<=N*N)ï¼Œè¡¨ç¤ºåŸé•‡çš„æ•°é‡å’Œé“è·¯çš„æ•°é‡ã€‚
The next Mlines, each contains three number A,B,C, denotes there is a road between A and B that needed C(1Ã—CÃ—1000) minutes to rebuild.
æ¥ä¸‹æ¥çš„çº¿ï¼Œæ¯æ¡çº¿åŒ…å«ä¸‰ä¸ªæ•°å­—A,B,Cï¼Œè¡¨ç¤ºåœ¨Aå’ŒBä¹‹é—´æœ‰ä¸€æ¡éœ€è¦Cåˆ†é’Ÿé‡å»ºçš„é“è·¯(1Ã—CÃ—1000)ã€‚
OutputFor each test case, you should output a line contains a number denotes the minimal time need to rebuild the roads so that all the towns are connected.
å¯¹äºæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œæ‚¨åº”è¯¥è¾“å‡ºä¸€è¡Œï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºé‡å»ºé“è·¯æ‰€éœ€çš„æœ€å°æ—¶é—´ï¼Œä»¥ä¾¿æ‰€æœ‰åŸé•‡éƒ½è¿æ¥èµ·æ¥ã€‚
*/
#include<stdio.h>
#include<string.h>
#include<algorithm>
using namespace std;
int n,m,u[1000005],v[1000005],w[1000005],r[1000005],p[1005];
int cmp(const int i,const int j)
{
    return w[i]<w[j];
}

int main()
{
    int T;
    scanf("%d",&T);
    while(T--)
    {
        scanf("%d%d",&n,&m);
        for(int i=0;i<m;i++)
        scanf("%d%d%d",&u[i],&v[i],&w[i]);
        printf("%d\n",kruskal());
    }
    return 0;
}

int find (int x)
{
    if(p[x]==x)
    return x;
    else return p[x]=find(p[x]);
}                                            //è·¯å¾„å‹ç¼©
int kruskal()
{
    int ans=0;
    for(int i=0;i<=n;i++) p[i]=i;
    for(int i=0;i<m;i++) r[i]=i;
    sort(r,r+m,cmp);
    for(int i=0;i<m;i++)
    {
        int e=r[i];int x=find(u[e]);int y=find(v[i]);
        if(x!=y)
        {
            ans+=w[e];
            p[x]=y;
        }
Â 
    }
    return ans;
}
```

### [b.å­©å­ä¸ç©å…·](lutece/æ•°æ®ç»“æ„ä¸“é¢˜/KIDS_toys.c)

### [c.é£Ÿç‰©é“¾â­](https://www.luogu.com.cn/problem/P2024)

é—®é¢˜1ï¼šå…¬å…±çˆ¶èŠ‚ç‚¹æ€ä¹ˆé€‰æ‹©ï¼Ÿè‹¥é€‰è€åŠæ³•ï¼Œåˆ™ä¸¤ä¸ªçˆ¶èŠ‚ç‚¹è¯´æ˜¯åŒä¸€ç‰©ç§åˆ™æ— æ³•åˆ¤æ–­ã€‚

åœ¨æœ‰seté›†åˆçš„æƒ…å†µä¸‹è¿˜å¯ä»¥åˆå§‹åŒ–ä¸€ä¸ªå¸ƒå°”ç±»å‹çš„judgeæ•°ç»„åˆ¤æ–­æ˜¯å¦è¿›è¡Œäº†æ“ä½œä¸€ã€‚

é—®é¢˜2ï¼šæ€ä¹ˆè¡¨ç¤ºåƒä¸è¢«åƒçš„å…³ç³»ï¼Ÿ

ç§ç±»å¹¶æŸ¥é›†ï¼ˆè¡¨æ˜ä¸åŒå…³ç³»ï¼‰ï¼Œå°†æœ‰å‘çš„å…³ç³»è½¬åŒ–ä¸ºå¹¶æŸ¥é›†å…³ç³»

#### **æ–¹æ³•ä¸€ï¼šç§ç±»å¹¶æŸ¥é›†**

```
åœ¨è¿™é‡Œxå…ƒç´ ï¼Œx+nå…ƒç´ ï¼Œx+2nå…ƒç´ ä¸‰è€…çš„å…³ç³»è¢«å®šä¹‰ä¸ºï¼š
xå…ƒç´ æ‰€åœ¨é›†åˆä¸­æ‰€æœ‰âˆˆ[1ï¼Œn]çš„å…ƒç´ éƒ½æ˜¯xå…ƒç´ çš„åŒç±»
x+nå…ƒç´ æ‰€åœ¨é›†åˆä¸­æ‰€æœ‰âˆˆ[1ï¼Œn]çš„å…ƒç´ éƒ½æ˜¯xå…ƒç´ çš„å¤©æ•Œ
x+2nå…ƒç´ æ‰€åœ¨é›†åˆä¸­æ‰€æœ‰âˆˆ[1ï¼Œn]çš„å…ƒç´ éƒ½æ˜¯xå…ƒç´ çš„çŒç‰©
x+nå…ƒç´ æ‰€åœ¨çš„é›†åˆä¸­æ‰€æœ‰âˆˆ[1ï¼Œn]çš„å…ƒç´ éƒ½æ˜¯x+2nå…ƒç´ çš„çŒç‰©

æˆ‘ä»¬å¯ä»¥é€šè¿‡x+nå…ƒç´ æ¥ç¡®å®šxå…ƒç´ ç›®å‰å·²çŸ¥çš„å¤©æ•Œï¼Œä¹Ÿå¯ä»¥é€šè¿‡x+2nå…ƒç´ æ¥ç¡®å®šxå…ƒç´ ç›®å‰çš„çŒç‰©ï¼Œè¿˜å¯ä»¥é€šè¿‡xå…ƒç´ æœ¬èº«æ¥ç¡®å®šxçš„åŒç±»
æˆ‘ä»¬åªéœ€è¦è®¤æ¸…ä»¥ä¸‹å‡ ç‚¹ï¼š
1.ä¸¤ä¸ªåŒç±»å…ƒç´ çš„å¤©æ•Œé›†åˆæ˜¯åŒä¸€ä¸ªé›†åˆï¼ŒçŒç‰©é›†åˆä¹Ÿæ˜¯åŒä¸€ä¸ªé›†åˆ
2.å¤©æ•Œçš„å¤©æ•Œæ˜¯çŒç‰©
3.çŒç‰©çš„çŒç‰©æ˜¯å¤©æ•Œ
å¯¹äºä¸€å¥çœŸè¯ï¼Œå½“xå…ƒç´ ,yå…ƒç´ æ˜¯åŒç±»æ—¶ï¼Œå°†ä»–ä»¬ä¸¤è€…çš„å¤©æ•Œé›†åˆï¼ˆx+nå…ƒç´ ä¸y+nå…ƒç´ æ‰€åœ¨é›†åˆï¼‰å’ŒçŒç‰©é›†åˆï¼ˆx+2nå…ƒç´ ä¸y+2nå…ƒç´ æ‰€åœ¨é›†åˆï¼‰ä»¥åŠè‡ªèº«æ‰€åœ¨çš„é›†åˆåˆ†åˆ«åˆå¹¶ã€‚
å½“xå…ƒç´ æ˜¯yå…ƒç´ çš„å¤©æ•Œæ—¶ï¼Œå°†xå…ƒç´ æ‰€åœ¨é›†åˆä¸yå…ƒç´ çš„å¤©æ•Œé›†åˆåˆå¹¶ï¼Œå°†yå…ƒç´ æ‰€åœ¨é›†åˆå’Œxå…ƒç´ çš„çŒç‰©é›†åˆåˆå¹¶ï¼Œå°†xå…ƒç´ çš„å¤©æ•Œé›†åˆå’Œyå…ƒç´ çš„çŒç‰©é›†åˆåˆå¹¶                          --åˆå¹¶åçš„çˆ¶èŠ‚ç‚¹æ˜¯è°å…¶å®ä¸é‡è¦ï¼Œæˆ‘ä»¬è¦çš„åªæ˜¯çœ‹åˆå¹¶åæ˜¯ä¸æ˜¯ä¸€ä¸ªé›†åˆé‡Œ
```

```cpp
#include<cstdio>
int fa[300005];
int n,k,ans;
inline int read()
{
    int sum=0;
    char ch=getchar();
    while(ch>'9'||ch<'0') ch=getchar();
    while(ch>='0'&&ch<='9') sum=sum*10+ch-48,ch=getchar();
    return sum;
}//è¯»å…¥ä¼˜åŒ–
int find(int x)
{
    if(x!=fa[x]) fa[x]=find(fa[x]);
    return fa[x];
}//æŸ¥è¯¢
int unity(int x,int y)         //yçš„ç¥–å…ˆæˆä¸ºå…¬å…±ç¥–å…ˆ
{
    int r1=find(fa[x]),r2=find(fa[y]);
    fa[r1]=r2;
}//åˆå¹¶
int main()
{
    int x,y,z;
    n=read(),k=read();
    for(int i=1;i<=3*n;++i) fa[i]=i; //å¯¹äºæ¯ç§ç”Ÿç‰©ï¼šè®¾ x ä¸ºæœ¬èº«ï¼Œx+n ä¸ºçŒç‰©ï¼Œx+2*n ä¸ºå¤©æ•Œ
    for(int i=1;i<=k;++i) 
    {
        z=read(),x=read(),y=read();
        if(x>n||y>n) {ans++; continue;} // ä¸å±äºè¯¥é£Ÿç‰©é“¾æ˜¾ç„¶ä¸ºå‡
        if(z==1)
        {
            if(find(x+n)==find(y)||find(x+2*n)==find(y)) {ans++; continue;}
            //å¦‚æœ1æ˜¯2çš„å¤©æ•Œæˆ–çŒç‰©ï¼Œæ˜¾ç„¶ä¸ºè°è¨€
            unity(x,y); unity(x+n,y+n); unity(x+2*n,y+2*n);//ä¸‰ç§å¹¶æŸ¥é›†åŒç±»éƒ½è¦ç›¸è¿
            //å¦‚æœä¸ºçœŸï¼Œé‚£ä¹ˆ1çš„åŒç±»å’Œ2çš„åŒç±»ï¼Œ1çš„çŒç‰©æ˜¯2çš„çŒç‰©ï¼Œ1çš„å¤©æ•Œæ˜¯2çš„å¤©æ•Œ
        }
        else if(z==2)
        {
            if(x==y) {ans++; continue;} //å…¶å®æ˜¯åºŸè¯ä½†æ˜¯å¯ä»¥ç¨å¾®çœç‚¹æ—¶é—´
            if(find(x)==find(y)||find(x+2*n)==find(y)) {ans++; continue;}
            //å¦‚æœ1æ˜¯2çš„åŒç±»æˆ–çŒç‰©ï¼Œæ˜¾ç„¶ä¸ºè°è¨€
            unity(x,y+2*n); unity(x+n,y); unity(x+2*n,y+n);//åƒå…³ç³»ä¸è¢«åƒå…³ç³»åŠ å»¶ä¼¸å…³ç³»
            //å¦‚æœä¸ºçœŸï¼Œé‚£ä¹ˆ1çš„åŒç±»æ˜¯2çš„å¤©æ•Œï¼Œ1çš„çŒç‰©æ˜¯2çš„åŒç±»ï¼Œ1çš„å¤©æ•Œæ˜¯2çš„çŒç‰©
        }
    }
    printf("%d\n",ans);
    return 0;
}
```

#### **æ–¹æ³•äºŒï¼šå¸¦æƒå¹¶æŸ¥é›†ï¼ˆå¦‚ä½•è½¬ç§»æƒå€¼æ˜¯éš¾ç‚¹ï¼‰**

å®ƒçš„æ¯ä¸€æ¡è¾¹éƒ½è®°å½•äº†æ¯ä¸ªèŠ‚ç‚¹åˆ°æ ¹èŠ‚ç‚¹çš„ä¸€ä¸ªæƒå€¼ï¼Œè¿™ä¸ªæƒå€¼è¯¥è®¾ä¸ºä»€ä¹ˆç”±å…·ä½“çš„é—®é¢˜è€Œå®šï¼Œä¸€èˆ¬éƒ½æ˜¯ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„æŸä¸€ç§ç›¸å¯¹çš„å…³ç³»ã€‚

```
åœ¨è¿™ä¸ªé¢˜ä¸­ç›¸å¯¹å…³ç³»å°±æ˜¯é£Ÿç‰©é“¾ä¸Šçš„å…³ç³»ï¼Œå› æ­¤å¸¦æƒå¹¶æŸ¥é›†ä¸­çš„æƒå€¼å°±åº”è¯¥è®°å½•ä¸¤ä¸ªåŠ¨ç‰©åœ¨é£Ÿç‰©é“¾ä¸Šçš„ç›¸å¯¹å…³ç³»ï¼ŒA->Bä¸º0è¡¨ç¤ºåŒç±»ï¼Œä¸º1è¡¨ç¤ºAåƒBï¼Œä¸º2è¡¨ç¤ºAè¢«Båƒã€‚è¿™ä¸ªå€¼ä¸åŒäºå‰é¢ä¸¤ä¸ªé¢˜ä¸­çš„åŒºé—´åˆã€åˆ†æ•°å·®ï¼Œå®ƒæ˜¯ä¸å¯ä»¥ç›´æ¥ç´¯åŠ çš„ï¼Œè¦è€ƒè™‘ä¸‰ä¸ªé—®é¢˜ï¼š

1.è·¯å¾„å‹ç¼©æ—¶ï¼Œå¦‚ä½•æ›´æ–°Value

å¦‚æœç°åœ¨æœ‰A->Bä¸º1ï¼ŒB->Cä¸º1ï¼Œæ€ä¹ˆæ±‚A->Cï¼Ÿæ˜¾ç„¶AåƒBï¼ŒBåƒCï¼Œé‚£ä¹ˆç”±é¢˜æ„Cåº”è¯¥åƒAï¼Œé‚£ä¹ˆA->Cåº”è¯¥ä¸º2ï¼›

å¦‚æœç°åœ¨æœ‰A->Bä¸º2ï¼ŒB->Cä¸º2ï¼Œæ€ä¹ˆæ±‚A->Cï¼Ÿæ˜¾ç„¶BåƒAï¼ŒCåƒBï¼Œé‚£ä¹ˆç”±é¢˜æ„Aåº”è¯¥åƒCï¼Œé‚£ä¹ˆA->Cåº”è¯¥ä¸º1ï¼›

å¦‚æœç°åœ¨æœ‰A->Bä¸º0ï¼ŒB->Cä¸º1ï¼Œæ€ä¹ˆæ±‚A->Cï¼Ÿæ˜¾ç„¶Aã€BåŒç±»ï¼ŒBåƒCï¼Œé‚£ä¹ˆç”±é¢˜æ„Aåº”è¯¥åƒCï¼Œé‚£ä¹ˆA->Cåº”è¯¥ä¸º1ï¼›

æ‰¾è§„å¾‹ä¸éš¾å‘ç°ï¼ŒA->C = (A->B + B->C) % 3ï¼Œå› æ­¤å…³ç³»å€¼çš„æ›´æ–°éœ€è¦ç´¯åŠ å†æ¨¡3ã€‚

2.åŒºé—´åˆå¹¶æ—¶ï¼Œå¦‚ä½•æ›´æ–°Value

ç”±1ä¸éš¾å‘ç°ï¼Œæœ¬é¢˜çš„Valueæ›´æ–°æ— éå°±æ˜¯å¤šäº†ä¸ªå–æ¨¡æ“ä½œï¼Œå› æ­¤ä¸éš¾éªŒè¯åŒºé—´åˆå¹¶çš„æ›´æ–°æ“ä½œåº”è¯¥ä¸ºï¼š

relationWithParent[fx] = (-relationWithParent[x] + relation + relationWithParent[y]) % 3

3.å¦‚ä½•åˆ¤æ–­æ˜¯å¦çŸ›ç›¾

ä¸åŒäºåˆ†æ•°ã€åŒºé—´å’Œï¼Œå¯ä»¥ç›´æ¥ç›¸å‡å¾—åˆ°è®¡ç®—ç»“æœï¼Œè¿™é‡Œè¦è§£å†³å¦‚æœå·²çŸ¥Aä¸æ ¹èŠ‚ç‚¹çš„å…³ç³»ï¼ŒBä¸æ ¹èŠ‚ç‚¹çš„å…³ç³»ï¼Œå¦‚ä½•æ±‚Aã€Bä¹‹é—´çš„å…³ç³»ï¼Ÿç”±äºå…³ç³»å€¼çš„è®¡ç®—è¦æ¨¡3ï¼Œå› æ­¤A->B=(A->C - B->C + 3) % 3ï¼ŒåŠ ä¸‰æ˜¯ä¸ºäº†é¿å…è´Ÿæ•°çš„å½±å“ã€‚å°†A->Bä¸é¢˜ç›®ç»™çš„Relationå€¼åˆ¤ç­‰æ¯”è¾ƒå³å¯ã€‚

```



<img src="C:/Users/HUAWEI/AppData/Roaming/Typora/typora-user-images/image-20240505200258444.png" alt="image-20240505200258444" style="zoom:67%;" />![image-20240505200439355](C:/Users/HUAWEI/AppData/Roaming/Typora/typora-user-images/image-20240505200439355.png)

<img src="C:/Users/HUAWEI/AppData/Roaming/Typora/typora-user-images/image-20240505200630785.png" alt="image-20240505200630785" style="zoom:67%;" />![image-20240505200644717](C:/Users/HUAWEI/AppData/Roaming/Typora/typora-user-images/image-20240505200644717.png)

```cpp
#include <iostream>  //å¸¦æƒå¹¶æŸ¥é›† é¢˜è§£ 
using namespace std;
int f[100000],re[100000];  //0-->åŒç§åŠ¨ç‰©ï¼Œ1-->æ•é£Ÿå…³ç³»ï¼Œ2-->è¢«æ•é£Ÿå…³ç³»ã€‚
int n,m,a,b,p,ans=0;

int find(int a)
{
   int fa=f[a];
   if (a!=fa) {
   	f[a]=find(fa);
   	re[a]=(re[a]+re[fa])%3;   
   	return f[a];
   }
   else return fa;
}
int main()
{
   cin>>n>>m;
   for (int i=1;i<=n;i++) f[i]=i,re[i]=0;
   for (int i=1;i<=m;i++)
   {
   	cin>>p>>a>>b;
   	if ((a>n||b>n)||(p==2&&a==b)) {   //ä¸¤ç§ç‰¹æ®Šæƒ…å†µ 
   		ans++; continue;
   	}
   	if (p==1)  //å¯¹å…³ç³»1è®¨è®º 
   	{
   		int f1=find(a),f2=find(b);
   		if (f1==f2&&re[a]!=re[b])  //åˆ¤æ–­æ˜¯å¦åœ¨åŒä¸€æ£µæ ‘åŠä¸¤è€…æ˜¯å¦ä¸ºåŒç§åŠ¨ç‰©ã€‚ 
   		{
   			ans++; continue;
   		}
   		else if(f1!=f2)
   		{
   			f[f1]=f2; re[f1]=(3-re[a]+re[b])%3;   //åˆå¹¶ 
   		}
   	}
   	if (p==2)  //å¯¹å…³ç³»2è®¨è®º 
   	{
   		int f1=find(a),f2=find(b);
   		if (f1==f2) 
   		{
   			int rela=(re[a]-re[b]+3)%3;  //ç”¨ä¸¤ä¸ªèŠ‚ç‚¹ä¸çˆ¶äº²çš„å…³ç³»æ¨å‡ºä¸¤è€…å…³ç³» 

   			if (rela!=1) {
//					cout<<"HERE?"<<endl;
   				ans++; continue;
   			}
   		}
   		else {
   			int f1=find(a),f2=find(b);
   			f[f1]=f2; re[f1]=(3-re[a]+re[b]+1)%3;   //åˆå¹¶ 
   		}
   	}
   }
   cout<<ans<<endl;
   return 0;
}
```

### d.HDU-3038-How Many Answers Are Wrong

`è¿™ä¸ªé¢˜é¢˜ç›®çš„åºŸè¯æ¯”è¾ƒå¤šï¼Œè¿™é‡Œç®€è¿°ä¸€ä¸‹å¤§æ„ï¼šæœ‰Mä¸ªæ•°ï¼Œä¸çŸ¥é“å®ƒä»¬å…·ä½“çš„å€¼ï¼Œä½†æ˜¯çŸ¥é“æŸä¸¤ä¸ªæ•°ä¹‹é—´ï¼ˆåŒ…æ‹¬è¿™ä¸¤ä¸ªæ•°ï¼‰çš„æ‰€æœ‰æ•°ä¹‹å’Œï¼Œç°åœ¨ç»™å‡ºNä¸ªè¿™æ ·çš„åŒºé—´å’Œä¿¡æ¯ï¼Œéœ€è¦åˆ¤æ–­æœ‰å¤šå°‘ä¸ªè¿™æ ·çš„åŒºé—´å’Œä¸å‰è¾¹å·²çŸ¥çš„åŒºé—´å’Œå­˜åœ¨çŸ›ç›¾ã€‚ä¾‹å¦‚ç»™å‡ºåŒºé—´å’Œ[1,4]ä¸º20ï¼Œ[3,4]ä¸º15ï¼Œå†ç»™å‡º[1,2]ä¸º30ï¼Œæ˜¾ç„¶è¿™ä¸ª[1,2]çš„å€¼å°±æœ‰é—®é¢˜ï¼Œå®ƒåº”è¯¥ä¸º20-15=5ã€‚`

![image-20240505173308452](C:/Users/HUAWEI/AppData/Roaming/Typora/typora-user-images/image-20240505173308452.png)

é‚£ä¹ˆéœ€è¦è€ƒè™‘ä»€ä¹ˆæ—¶å€™ä¸€ä¸ªåŒºé—´çš„å€¼å¯ä»¥ç”±ä¹‹å‰çš„åŒºé—´æ±‚å‡ºæ¥å‘¢ï¼Ÿè§‚å¯Ÿä¸Šè¾¹è¿™å¼ å›¾ï¼Œçº¢è‰²çš„è¿™æ¡è¾¹æ˜¯æ±‚ä¸å‡ºæ¥çš„ï¼Œè€Œç»¿è‰²çš„æ˜¯å¯ä»¥æ±‚å‡ºæ¥çš„ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸º**0ã€2å±äºåŒä¸€ä¸ªå¹¶æŸ¥é›†ï¼Œ0ã€3ä¸å±äºåŒä¸€ä¸ªå¹¶æŸ¥é›†ï¼Œå› æ­¤ä¸éš¾å¾—å‡ºæœ¬é¢˜çš„æ±‚è§£æ€è·¯ï¼šå¦‚æœç»™å®šåŒºé—´çš„ä¸¤ä¸ªç«¯ç‚¹å±äºåŒä¸€ä¸ªå¹¶æŸ¥é›†ï¼Œåˆ¤æ–­è¿™ä¸ªåŒºé—´çš„å€¼æ˜¯å¦ä¸è®¡ç®—å¾—åˆ°çš„å€¼ç›¸ç­‰ï¼›å¦‚æœç»™å®šåŒºé—´çš„ä¸¤ä¸ªç«¯ç‚¹ä¸å±äºåŒä¸€ä¸ªå¹¶æŸ¥é›†ï¼Œå°†è¿™ä¸¤ä¸ªå¹¶æŸ¥é›†åˆå¹¶ã€‚**<u>å¹¶æŸ¥é›†è¾¹çš„æƒå€¼å°±ç­‰äºé¢˜å¹²ä¸­çš„åŒºé—´å’Œã€‚</u>

```cpp
/*å‹ç¼©*/
int find(int x)
{
	if (x != parent[x])
	{
		int t = parent[x];
		parent[x] = find(parent[x]);            //è·¯å¾„å‹ç¼©
		value[x] += value[t];                   //å› ä¸ºåç»­è¦è¿›è¡Œè·¯å¾„å‹ç¼©
	}
	return parent[x];
}
/*åˆå¹¶*/
		int px = find(x);
		int py = find(y);
		if (px != py)
		{
			parent[px] = py;
			value[px] = -value[x] + value[y] + s;             //å¤„ç†value
		}
```

```cpp
#define _CRT_SECURE_NO_WARNINGS
 
#include <iostream>
#include <stdio.h>
using namespace std;
 
const int maxM = 200005;
int parent[maxM];
int sum[maxM];
 
int Find(int x)
{
	if (x != parent[x])
	{
		int i = parent[x];
		parent[x] = Find(parent[x]);
		sum[x] += sum[i];
	}
	return parent[x];
}
 
 
int main()
{
	int m, n;
	int ans = 0;
	while (scanf("%d%d", &m, &n) != EOF)
	{
		for (int i = 0; i <= m; i++)
		{
			parent[i] = i;
			sum[i] = 0;
		}
		ans = 0;
		while (n--)
		{
			int l, r, value;
			cin >> l >> r >> value;
			l--;
			int fl = Find(l);
			int fr = Find(r);
			if (fl == fr)
			{
				if ((sum[l] - sum[r]) != value)        //å› ä¸ºå°±ç®—æ›´æ–°ä¹Ÿæ˜¯ï¼ˆsum[l]+Î”dï¼‰ - ï¼ˆsum[r]+Î”d)
                {
					ans++;
				}
			}
			else {
				parent[fl] = fr;                             //è°ä½œä¸ºæ ¹èŠ‚ç‚¹å…¶å®ä¸é‡è¦
				sum[fl] = -sum[l] + sum[r] + value;           //ç”»å›¾è¿›è¡ŒéªŒè¯
			}
		}
		cout << ans << endl;
	}
	return 0;
}
```



# ä¸‰ã€å•è°ƒæ ˆ

## 1ã€å®šä¹‰

ä»åå­—ä¸Šå°±å¬çš„å‡ºæ¥ï¼Œå•è°ƒæ ˆä¸­å­˜æ”¾çš„æ•°æ®åº”è¯¥æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥å•è°ƒæ ˆä¹Ÿåˆ†ä¸º**å•è°ƒé€’å¢æ ˆ**å’Œ**å•è°ƒé€’å‡æ ˆ**

- å•è°ƒé€’å¢æ ˆï¼šå•è°ƒé€’å¢æ ˆå°±æ˜¯ä»æ ˆåº•åˆ°æ ˆé¡¶æ•°æ®æ˜¯ä»å¤§åˆ°å°
- å•è°ƒé€’å‡æ ˆï¼šå•è°ƒé€’å‡æ ˆå°±æ˜¯ä»æ ˆåº•åˆ°æ ˆé¡¶æ•°æ®æ˜¯ä»å°åˆ°å¤§

## 2ã€ä¾‹é¢˜

 1.ã€æ¨¡æ¿ã€‘å•è°ƒæ ˆ

**é¢˜ç›®èƒŒæ™¯**

æ¨¡æ¿é¢˜ï¼Œæ— èƒŒæ™¯ã€‚  2019.12.12 æ›´æ–°æ•°æ®ï¼Œæ”¾å®½æ—¶é™ï¼Œç°åœ¨ä¸å†å¡å¸¸äº†ã€‚

**é¢˜ç›®æè¿°**

ç»™å‡ºé¡¹æ•°ä¸º $n$ çš„æ•´æ•°æ•°åˆ— $a_{1 \dots n}$ã€‚

å®šä¹‰å‡½æ•° $f(i)$ ä»£è¡¨æ•°åˆ—ä¸­ç¬¬ $i$ ä¸ªå…ƒç´ ä¹‹åç¬¬ä¸€ä¸ªå¤§äº $a_i$ çš„å…ƒç´ çš„**ä¸‹æ ‡**ï¼Œå³ $f(i)=\min_{i<j\leq n, a_j > a_i} \{j\}$ã€‚è‹¥ä¸å­˜åœ¨ï¼Œåˆ™ $f(i)=0$ã€‚

è¯•æ±‚å‡º $f(1\dots n)$ã€‚

**è¾“å…¥æ ¼å¼**

ç¬¬ä¸€è¡Œä¸€ä¸ªæ­£æ•´æ•° $n$ã€‚ç¬¬äºŒè¡Œ $n$ ä¸ªæ­£æ•´æ•° $a_{1\dots n}$ã€‚

**è¾“å‡ºæ ¼å¼**

ä¸€è¡Œ $n$ ä¸ªæ•´æ•°è¡¨ç¤º $f(1), f(2), \dots, f(n)$ çš„å€¼ã€‚

**æ ·ä¾‹è¾“å…¥ #1**

```
5
1 4 2 3 5
```

**æ ·ä¾‹è¾“å‡º #1**

```
2 5 4 5 0
```

ã€æ•°æ®è§„æ¨¡ä¸çº¦å®šã€‘

å¯¹äº $30\%$ çš„æ•°æ®ï¼Œ$n\leq 100$ï¼›å¯¹äº $60\%$ çš„æ•°æ®ï¼Œ$n\leq 5 \times 10^3$ ï¼›å¯¹äº $100\%$ çš„æ•°æ®ï¼Œ$1 \le n\leq 3\times 10^6$ï¼Œ$1\leq a_i\leq 10^9$ã€‚

```cpp
/*æ„é€ å•è°ƒé€’å¢æ ˆ*/
#include<cstdio>
#include<stack>
using namespace std;
int n,a[3000005],f[3000005];//aæ˜¯éœ€è¦åˆ¤æ–­çš„æ•°ç»„ï¼ˆå³è¾“å…¥çš„æ•°ç»„ï¼‰ï¼Œfæ˜¯å­˜å‚¨ç­”æ¡ˆçš„æ•°ç»„
stack<int>s;//æ¨¡æ‹Ÿç”¨çš„æ ˆ
int main()
{
	scanf("%d",&n);
	for(int i=1;i<=n;i++) scanf("%d",&a[i]);
	for(int i=n;i>=1;i--)
	{
		while(!s.empty()&&a[s.top()]<=a[i]) s.pop();//å¼¹å‡ºæ ˆé¡¶æ¯”å½“å‰æ•°å°çš„
		f[i]=s.empty()?0:s.top();//å­˜å‚¨ç­”æ¡ˆï¼Œç”±äºæ²¡æœ‰æ¯”å¥¹å¤§çš„è¦è¾“å‡º0ï¼Œæ‰€ä»¥åŠ äº†ä¸ªä¸‰ç›®è¿ç®—
		s.push(i);//å‹å…¥å½“å‰å…ƒç´ 
	}
	for(int i=1;i<=n;i++) printf("%d ",f[i]);//è¾“å‡º
	return 0;
}
```

2.æ±‚æœ€å¤§åŒºé—´

æè¿°ï¼šç»™å‡ºä¸€ç»„æ•°å­—ï¼Œæ±‚ä¸€åŒºé—´ï¼Œä½¿å¾—åŒºé—´å…ƒç´ å’Œä¹˜ä»¥åŒºé—´æœ€å°å€¼æœ€å¤§ï¼Œç»“æœè¦æ±‚ç»™å‡ºè¿™ä¸ªæœ€å¤§å€¼å’ŒåŒºé—´çš„å·¦å³ç«¯ç‚¹

```cpp
/*
è§£é‡Šï¼šå°†3åˆ°5ï¼ˆ6+4+5ï¼‰è¿™æ®µåŒºé—´ç›¸åŠ ï¼Œå°†å’Œä¸åŒºé—´å†…æœ€å°å…ƒç´ ç›¸ä¹˜è·å¾—æœ€å¤§æ•°å­—60
æ€è·¯ï¼šä½¿ç”¨æš´åŠ›è§£æ³•æ±‚å‡ºæ‰€æœ‰åŒºé—´ï¼Œå†æ±‚å‡ºåŒºé—´çš„æœ€å°å€¼ç›¸ä¹˜è·Ÿæ–°æ•°æ®ï¼Œå¹¶ä¸æ˜¯ä¸€ç§å¾ˆå¥½çš„ç®—æ³•ï¼Œæ‰€ä»¥ç»è¿‡ä¸Šé¢ä¿©é¢˜çš„ç£¨â€‚ â€‚â€‚â€‚ â€‚â€‚ ç‚¼ï¼Œæ­¤æ—¶æˆ‘ä»¬åº”è¯¥ä½¿ç”¨ä¸€ä¸ªå•è°ƒé€’å‡æ ˆ

1.è®¾ç½®ä¸€ä¸ªå•è°ƒé€’å‡çš„æ ˆï¼ˆæ ˆå†…0~nä¸ºå•è°ƒé€’å¢ï¼‰
2.å½“é‡åˆ°å°äºæ ˆé¡¶å…ƒç´ çš„å€¼ï¼Œæˆ‘ä»¬å¼€å§‹æ›´æ–°æ•°æ®ï¼Œå› ä¸ºå½“å‰é‡åˆ°çš„å€¼ä¸€å®šæ˜¯å½“å‰åºåˆ—æœ€å°çš„
*/
int GetMaxSequence(vector<int>& v)
{
	stack<int> st;
	vector<int> vs(v.size()+1);
	vs[0] = 0;
	for (int i = 1; i < vs.size(); i++)
	{
			vs[i] = vs[i - 1] + v[i-1];
	}
	v.push_back(-1);
	int top, start, end, ret = 0;
	for (int i = 0; i < v.size(); i++)
	{
		if (st.empty() || v[st.top()] <= v[i])
		{
			st.push(i);
		}
		else
		{
			while (!st.empty() && v[st.top()] > v[i])
			{
				top = st.top();
				st.pop();
				int tmp = vs[i] - vs[top];
				tmp = tmp * v[top];
				if (tmp > ret)
				{
					ret = tmp;
					start = top+1;
					end = i;
				}
			}
			st.push(top);
			v[top] = v[i];//ä¸ç¬¬äºŒé¢˜ç›¸åŒçš„é“ç†ï¼Œå°†å½“å‰æ•°æ®çš„æ›´æ”¹æœ€å·¦çš„topä¸‹æ ‡ï¼Œé˜²æ­¢å‡ºç°æ¯”å½“å‰æ•°æ®æ›´å°çš„æ•°æ®
			//è¿™å¥åœ¨è¿™é“é¢˜é‡ŒçœŸçš„è¶…çº§éš¾ç†è§£ï¼Œä½†æ˜¯åªè¦ä½ æœ‰è€å¿ƒç›¸ä¿¡ä½ å¯ä»¥ç†è§£çš„
		}
	}
	return ret
}

```

# å››ã€æ ‘çŠ¶æ•°ç»„

## 1ã€åŸºæœ¬æ¦‚å¿µ

ç»“æ„ä¸º[æ ‘å½¢ç»“æ„](https://so.csdn.net/so/search?q=æ ‘å½¢ç»“æ„&spm=1001.2101.3001.7020)çš„æ•°ç»„ï¼ŒäºäºŒå‰æ ‘çš„ç»“æ„ç±»ä¼¼ä½†åˆä¸åŒï¼Œå®ƒæ˜¯åœ¨äºŒå‰æ ‘çš„ç»“æ„ä¸Šåˆ é™¤äº†ä¸€äº›ä¸­é—´èŠ‚ç‚¹ã€‚

<img src="https://img-blog.csdnimg.cn/20210703102919678.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1RoZVdheUZvckRyZWFt,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom:67%;" />

## 2ã€é€‚ç”¨èŒƒå›´

**1.å•ç‚¹ä¿®æ”¹ï¼Œå•ç‚¹æŸ¥è¯¢ï¼Œ2.åŒºé—´ä¿®æ”¹ï¼Œå•ç‚¹æŸ¥è¯¢ï¼Œ3.åŒºé—´æŸ¥è¯¢ï¼ŒåŒºé—´ä¿®æ”¹**



lowbit(x) = x&(-x)           [ è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ•°è¿›è¡Œä½è¿ç®— ]

<img src="https://img-blog.csdnimg.cn/20210703105626218.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1RoZVdheUZvckRyZWFt,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom: 50%;" />

### 2.1å•ç‚¹ä¿®æ”¹ï¼ŒåŒºé—´æŸ¥è¯¢

==æ ‘çŠ¶æ•°ç»„ä¸­èŠ‚ç‚¹xçš„çˆ¶èŠ‚ç‚¹ä¸º**x+lowbit(x)**==

<img src="https://img-blog.csdnimg.cn/20210703111100776.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1RoZVdheUZvckRyZWFt,size_16,color_FFFFFF,t_70" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" style="zoom:50%;" />

***é€šè¿‡askæ“ä½œç¡®ä¿æ¯æ¬¡è¿”å›ç»“æœéƒ½æ˜¯ä¸€ä¸ªå‰ç¼€ç»“æœ***

***é€šè¿‡addæ“ä½œç¡®ä¿æ¯æ¬¡èƒ½å°†æ‰€æœ‰ç®¡è¾–è¯¥ç‚¹çš„æ ‘çŠ¶æ•°ç»„å…ƒç´ éƒ½è¢«æ›´æ–°***

```cpp
/*å•ç‚¹ä¿®æ”¹*/
//å•ç‚¹æ›´æ–°å®é™…ä¸Šæ˜¯ä¸ä¿®æ”¹Aæ•°ç»„çš„ï¼Œè€Œæ˜¯ä¿®æ”¹æ ‘çŠ¶æ•°ç»„Cï¼ˆæˆ–æ˜¯tï¼‰ 
int add_dandian(int x,int k)
{
	for(int i=x;i<=n;i+=lowbit(i))         //åŒæ­¥æ›´æ–°åŒºé—´
	t[i]+=k;
}

/*[ 1ï¼Œx ]é—­åŒºé—´æŸ¥è¯¢*/
int ask(x){                               //é€šè¿‡askæ“ä½œç¡®ä¿æ¯æ¬¡è¿”å›ç»“æœéƒ½æ˜¯ä¸€ä¸ªå‰ç¼€ç»“æœ
	int sum = 0;
	for(int i=x;i;i-=lowbit(i)){             //é€šè¿‡x=x-lowbitï¼ˆxï¼‰æ›´æ–°
		sum+=t[i];
	}
	return sum;
}

/*[ L,R ]åŒºé—´æŸ¥è¯¢*/
int search(int L,int R)
{
	int ans = 0;
	for(int i=L-1;i;i-=lowbit(i))
	ans-=t[i];
	for(int i=R;i;i-=lowbit(i))
	ans+=t[i];
	return 0;
}
```



### 2.2åŒºé—´ä¿®æ”¹ï¼Œå•ç‚¹æŸ¥è¯¢â­

å¯¹äºè¿™ä¸€ç±»æ“ä½œï¼Œæˆ‘ä»¬éœ€è¦æ„é€ å‡ºåŸæ•°ç»„çš„å·®åˆ†æ•°ç»„bï¼Œç„¶åç”¨æ ‘çŠ¶æ•°ç»„ç»´æŠ¤bæ•°ç»„å³å¯ã€‚

å¯¹äºåŒºé—´ä¿®æ”¹çš„è¯ï¼Œæˆ‘ä»¬åªéœ€è¦å¯¹å·®åˆ†æ•°ç»„è¿›è¡Œæ“ä½œå³å¯ã€‚

```cpp
/*åŒºé—´ä¿®æ”¹*/
int update(int pos,int k)//posè¡¨ç¤ºä¿®æ”¹ç‚¹çš„ä½ç½®,Kè¡¨ç¤ºä¿®æ”¹çš„å€¼ä¹Ÿå³+Kæ“ä½œ
{
	for(int i=pos;i<=n;i+=lowbit(i))
	c[i]+=k;                    
	return 0;
}
update(L,k);
update(R+1,-k);

/*å•ç‚¹æŸ¥è¯¢*/
ll ask(int pos)//è¿”å›åŒºé—´posåˆ°1çš„æ€»å’Œ
{
	ll ans=0;
	for(int i=pos;i;i-=lowbit(i)) ans+=c[i];
	return ans;
} 
```

ä¿®æ”¹æ•ˆç‡$*Oï¼ˆq lognï¼‰*$

```cpp
/*åŒºé—´ä¿®æ”¹ä¸å•ç‚¹æŸ¥è¯¢æ¨¡æ¿*/
#include<iostream>
#include<cstdio>
#define ll long long
using namespace std;
ll n,q,mod,x,y,s,inn[500001],tree[500001];                  //cppè‡ªåŠ¨åˆå§‹åŒ–ä¸º0
ll lowbit(ll num){
	return num&-num;//è¿”å›å€¼ä¸ºäºŒè¿›åˆ¶ä¸‹numä»å·¦å¾€å³ç¬¬ä¸€ä¸ª1çš„ä½ç½® 
}
void add(ll s,ll num){
	for(ll i=s;i<=n;i+=lowbit(i)) tree[i]+=num;//å·®åˆ†çš„æ€æƒ³ 
}
ll ask(ll s){
	ll ans=0;
	for(ll i=s;i>=1;i-=lowbit(i)) ans+=tree[i];//å¯»æ‰¾å·®åˆ†çš„æ ‡è®° 
	return ans;
}
int main(){
	scanf("%lld%lld",&n,&q);                   //nä¸ªæ•°æ®ï¼Œqæ¬¡æ“ä½œ
	for(int i=1;i<=n;i++) scanf("%lld",&inn[i]);
	for(int i=1;i<=q;i++){
		scanf("%lld",&mod);//è¾“å…¥1æˆ–2 
		if(mod==1){
			scanf("%lld%lld%lld",&x,&y,&s);
			add(x,s);
			add(y+1,-s);
		}
		if(mod==2){
			scanf("%lld",&x);
			printf("%lld\n",inn[x]+ask(x));//åŒºé—´æŸ¥è¯¢åˆ™ä¸ºå³è¾¹ç•Œå‰ç¼€å’Œå‡å»å·¦è¾¹ç•Œå‰ç¼€å’Œ 
		}
	}
}
```



### 2.3åŒºé—´æŸ¥è¯¢ï¼ŒåŒºé—´ä¿®æ”¹

ç”¨çº¿æ®µæ ‘æ›´ä¸ºç®€ä¾¿

### 3ã€ä¾‹é¢˜

#### [3.1é€†åºå¯¹](https://www.luogu.com.cn/problem/P1908)

**é¢˜ç›®æè¿°**

çŒ«çŒ« TOM å’Œå°è€é¼  JERRY æœ€è¿‘åˆè¾ƒé‡ä¸Šäº†ï¼Œä½†æ˜¯æ¯•ç«Ÿéƒ½æ˜¯æˆå¹´äººï¼Œä»–ä»¬å·²ç»ä¸å–œæ¬¢å†ç©é‚£ç§ä½ è¿½æˆ‘èµ¶çš„æ¸¸æˆï¼Œç°åœ¨ä»–ä»¬å–œæ¬¢ç©ç»Ÿè®¡ã€‚æœ€è¿‘ï¼ŒTOM è€çŒ«æŸ¥é˜…åˆ°ä¸€ä¸ªäººç±»ç§°ä¹‹ä¸ºâ€œé€†åºå¯¹â€çš„ä¸œè¥¿ï¼Œè¿™ä¸œè¥¿æ˜¯è¿™æ ·å®šä¹‰çš„ï¼šå¯¹äºç»™å®šçš„ä¸€æ®µæ­£æ•´æ•°åºåˆ—ï¼Œé€†åºå¯¹å°±æ˜¯åºåˆ—ä¸­ $a_i>a_j$ ä¸” $i<j$ çš„æœ‰åºå¯¹ã€‚çŸ¥é“è¿™æ¦‚å¿µåï¼Œä»–ä»¬å°±æ¯”èµ›è°å…ˆç®—å‡ºç»™å®šçš„ä¸€æ®µæ­£æ•´æ•°åºåˆ—ä¸­é€†åºå¯¹çš„æ•°ç›®ã€‚æ³¨æ„åºåˆ—ä¸­å¯èƒ½æœ‰é‡å¤æ•°å­—ã€‚

**è¾“å…¥æ ¼å¼**

ç¬¬ä¸€è¡Œï¼Œä¸€ä¸ªæ•° $n$ï¼Œè¡¨ç¤ºåºåˆ—ä¸­æœ‰ $n$ä¸ªæ•°ã€‚

ç¬¬äºŒè¡Œ $n$ ä¸ªæ•°ï¼Œè¡¨ç¤ºç»™å®šçš„åºåˆ—ã€‚åºåˆ—ä¸­æ¯ä¸ªæ•°å­—ä¸è¶…è¿‡ $10^9$ã€‚

**è¾“å‡ºæ ¼å¼**

è¾“å‡ºåºåˆ—ä¸­é€†åºå¯¹çš„æ•°ç›®ã€‚

**æ ·ä¾‹è¾“å…¥ #1**

```
6
5 4 2 6 3 1
```

**æ ·ä¾‹è¾“å‡º** #1

```
11
```

å¯¹äº $25\%$ çš„æ•°æ®ï¼Œ$n \leq 2500$ï¼Œå¯¹äº $50\%$ çš„æ•°æ®ï¼Œ$n \leq 4 \times 10^4$ã€‚ï¼Œå¯¹äºæ‰€æœ‰æ•°æ®ï¼Œ$n \leq 5 \times 10^5$

è¯·ä½¿ç”¨è¾ƒå¿«çš„è¾“å…¥è¾“å‡ºï¼Œåº”è¯¥ä¸ä¼š $O(n^2)$ è¿‡ 50 ä¸‡å§ 

##### è§£æ³•ä¸€ï¼šå½’å¹¶æ’åº

é€šè¿‡å½’å¹¶æ’åºè¾¾åˆ°åˆ†æ²»çš„æ•ˆæœï¼Œå°†æ—¶é—´å¤æ‚åº¦ä»Oï¼ˆ$n^2$ï¼‰é™ä¸ºOï¼ˆ$nlogn$ï¼‰ã€‚

- **é€’å½’å±‚æ•°**ï¼š

  - ä»ä¸€ä¸ªå¤§å°ä¸º ğ‘› çš„æ•°ç»„å¼€å§‹ï¼Œæ¯æ¬¡å°†æ•°ç»„åˆ†æˆä¸¤åŠï¼Œæ‰€ä»¥ç¬¬ ğ‘–å±‚é€’å½’å¤„ç†çš„å­æ•°ç»„çš„å¤§å°æ˜¯ $ğ‘›/(2^i)$ã€‚è¿™ä¸ªåˆ†è§£è¿‡ç¨‹ä¸€ç›´æŒç»­åˆ°æ•°ç»„å¤§å°ä¸º 1ï¼Œæ‰€ä»¥é€’å½’çš„æ·±åº¦ä¸º log(*n*)ã€‚

- **æ¯å±‚çš„å·¥ä½œé‡**ï¼š

  - åœ¨ç¬¬ ğ‘– å±‚ï¼Œæ€»å…±æœ‰$2^i$ä¸ªå­æ•°ç»„ï¼Œæ¯ä¸ªå­æ•°ç»„çš„å¤§å°ä¸º $ğ‘›/(2^i)$ã€‚åˆå¹¶è¿™äº›å­æ•°ç»„çš„æ€»æˆæœ¬æ˜¯$2^i*ğ‘›/(2^i)=n$ã€‚è¿™æ˜¯å› ä¸ºè™½ç„¶æ¯ä¸ªåˆå¹¶æ“ä½œçš„æˆæœ¬è¾ƒå°ï¼Œä½†éœ€è¦æ‰§è¡Œè®¸å¤šåˆå¹¶æ“ä½œï¼Œå…¶æ€»å’Œæ˜¯ nã€‚

- **æ€»æ—¶é—´å¤æ‚åº¦**ï¼š

  - å› æ­¤ï¼Œåœ¨æ¯å±‚é€’å½’ä¸­ï¼Œå·¥ä½œé‡éƒ½æ˜¯ ğ‘‚(ğ‘›),å¹¶ä¸”æœ‰ $logn$ å±‚é€’å½’ï¼Œæ‰€ä»¥æ€»çš„æ—¶é—´å¤æ‚åº¦æ˜¯ ğ‘‚( $nlogn$â€‹ )ã€‚

  > ```
  > //åœ¨æŸä¸ªæ—¶å€™ï¼Œå·¦åŒºé—´ï¼š  5 6 7  ä¸‹æ ‡ä¸ºi
  > //           å³åŒºé—´ï¼š  1 2 9  ä¸‹æ ‡ä¸ºj
  > //          
  > //è¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¿›è¡Œåˆå¹¶ï¼š
  > //step 1ï¼šç”±äº 5>1ï¼Œæ‰€ä»¥äº§ç”Ÿäº†é€†åºå¯¹ï¼Œè¿™é‡Œï¼Œæˆ‘ä»¬å‘ç°ï¼Œå·¦åŒºé—´æ‰€æœ‰è¿˜æ²¡æœ‰è¢«åˆå¹¶çš„æ•°éƒ½æ¯” 1 å¤§ï¼Œæ‰€ä»¥1ä¸å·¦åŒºé—´æ‰€æœ‰å…ƒç´ å…±äº§ç”Ÿäº† 3 ä¸ªé€†åºå¯¹(å³tot_numleft-i+1å¯¹)ï¼Œç»Ÿè®¡ç­”æ¡ˆå¹¶åˆå¹¶ 1 
  > //step 2ï¼šç”±äº 5>2ï¼Œç”±ä¸Šäº§ç”Ÿäº†3å¯¹é€†åºå¯¹ï¼Œç»Ÿè®¡ç­”æ¡ˆå¹¶åˆå¹¶ 2
  > //step 3ï¼šç”±äº 5<9, æ²¡æœ‰é€†åºå¯¹äº§ç”Ÿï¼Œå³åŒºé—´ä¸‹æ ‡ j++
  > //step 4ï¼šç”±äº 6<9, æ²¡æœ‰é€†åºå¯¹äº§ç”Ÿï¼Œå³åŒºé—´ä¸‹æ ‡ j++
  > //step 5ï¼šç”±äº 7<9, æ²¡æœ‰é€†åºå¯¹äº§ç”Ÿï¼Œå³åŒºé—´ä¸‹æ ‡ j++
  > //step 6ï¼šç”±äºå³åŒºé—´å·²ç»ç»“æŸï¼Œæ­£å¸¸æ‰§è¡Œåˆå¹¶å·¦åŒºé—´å‰©ä½™ï¼Œç»“æŸ
  > 
  > //PSï¼š tot_numleft=3ï¼Œå³å·¦åŒºé—´æ€»å…ƒç´ ä¸ªæ•°
  > ```
  >
  > ç”±äºå½’å¹¶æ’åºæ²¡æœ‰ä»€ä¹ˆå‘ï¼Œæ­£å¸¸æ‰§è¡Œå¹¶ç»Ÿè®¡å³å¯ï¼Œæ³¨æ„ç­”æ¡ˆä¼šçˆ† ğ‘–ğ‘›ğ‘¡ï¼**æˆ‘ä»¬éœ€è¦ä½¿ç”¨*ğ‘™ğ‘œğ‘›ğ‘” ğ‘™ğ‘œğ‘›ğ‘”*å­˜ans**ï¼Œå¦‚æœä½¿ç”¨ ğ‘ğ‘Ÿğ‘–ğ‘›ğ‘¡ğ‘“è¾“å‡ºï¼Œé‚£ä¹ˆå¯åˆ«å¿˜äº†ç”¨%ğ‘™ğ‘™ğ‘‘ï¼

```cpp
#include<cstdio>
#include<iostream>
using namespace std;
int n,a[500010],c[500010];
long long ans;

void msort(int b,int e)//å½’å¹¶æ’åº
{
    if(b==e)  
		return;
    int mid=(b+e)/2,i=b,j=mid+1,k=b;
    msort(b,mid),msort(mid+1,e);
    while(i<=mid&&j<=e)
    	if(a[i]<=a[j])
    		c[k++]=a[i++];
    	else
    		c[k++]=a[j++],ans+=mid-i+1;//ç»Ÿè®¡ç­”æ¡ˆ
    while(i<=mid)
    	c[k++]=a[i++];
    while(j<=e)
    	c[k++]=a[j++];
    for(int l=b;l<=e;l++)
    	a[l]=c[l];
} 

int main()
{
    scanf("%d",&n); 
    for(int i=1;i<=n;i++)
    	scanf("%d",&a[i]);
    msort(1,n);
    printf("%lld",ans);
    return 0;
}
```

##### è§£æ³•äºŒï¼šæ ‘çŠ¶æ•°ç»„â­

é¦–å…ˆå°†æ•°æ®**ç¦»æ•£åŒ–å¹¶æŒ‰åŸå¤§å°æ’åº**								                        									ç¦»æ•£åŒ–å°±æ˜¯æŠŠå¤§è€Œåˆ†æ•£çš„ä¸€æ®µæ®µä½¿ç”¨åˆ°çš„ç¨€ç–åŒºé—´ï¼Œæ•´åˆæ˜ å°„åˆ°è¿ç»­çš„ä¸€æ®µè¾ƒå°çš„ç¨ å¯†åŒºé—´é‡Œï¼Œç„¶åå°±å¯ä»¥é€šè¿‡æ™®é€šå‰ç¼€å’Œå…¬å¼æ¥è®¡ç®—è¿ç»­ä¸€æ®µçš„åŒºé—´å’Œï¼Œæœ¬è´¨ä¸Šå°±æ˜¯åŒ–å¤§ä¸ºå°ï¼ŒæŠŠç¨€ç–ç¦»æ•£åŒ–ç®€ä¸ºç¨ å¯†è¿ç»­çš„ä¸€æ®µã€‚

> > [!IMPORTANT]
> >
> > **å†æ”¾å…¥å“ˆå¸Œæ•°ç»„ï¼ˆåº•å±‚æ•°ç»„ï¼‰ã€å®è´¨ä¸Šæ˜¯æŒ‰ç…§å®é™…å¤§å°é¡ºåºå…¥çš„æ•°ç»„ã€‚æˆ‘è¦å­˜å…¥2å°±çœ‹1æ˜¯ä¸æ˜¯åœ¨å³è¾¹ï¼Œæˆ‘è¦å­˜å…¥3å°±çœ‹2å’Œ1æ˜¯ä¸æ˜¯åœ¨å³è¾¹ï¼›æˆ‘è¦å­˜å…¥4å°±çœ‹1,2,3,æ˜¯ä¸æ˜¯åœ¨å³è¾¹â€¦â€¦è€Œæˆ‘ä»¬é€šè¿‡ç¦»æ•£åŒ–èµ‹ç»™æ¯ä¸ªå®é™…æ•°å­—çš„idï¼ˆé€šè¿‡è®°å½•äº†çš„ä½ç½®ä¿¡æ¯ï¼‰æ­£å¥½å¯ä»¥å¸®åŠ©æˆ‘ä»¬åˆ¤æ–­å·¦å³ä¸¤è¾¹çš„å…ƒç´ ä¸ªæ•°ã€‘ï¼ŒåŒæ—¶å®æ—¶ä¿®æ”¹æ ‘çŠ¶æ•°ç»„**

ä¾‹å¦‚ï¼š**ç¦»æ•£åŒ–åŠ å‰ç¼€å’Œè§£å†³**

<img src="https://img-blog.csdnimg.cn/9b5e786edf78434dab7a42e7e7de6931.png" alt="img" style="zoom:50%;" />

```cpp
#include<iostream>
#include<vector>
#include<algorithm>
using namespace std;
typedef pair<int,int> PII;
const int N=300010;
int n,m;
int a[N];//å‚¨å­˜çš„æ˜¯æ•°
int s[N];//å‰ç¼€å’Œ
vector<int> alls;//å­˜çš„æ‰€æœ‰å¾…ç¦»æ•£åŒ–çš„å€¼
vector<PII> add,query;//ç”¨ä¸€å¯¹æ•°æ¥å­˜å‚¨ä¸¤ç§æ“ä½œ
int findx(int x)//findxå‡½æ•°ç”¨äºæ‰¾åˆ°aä¸­ä½ç½®xåœ¨allsä¸­èƒ½æ’åˆ°ç¬¬å‡ ä¸ª
{
    int left=0;int right=alls.size()-1;
    while(left<right)
    {int mid=(left+right)>>1;
        if(alls[mid]>=x)right=mid;
        else left=mid+1;
    }
    return right+1;//åŠ 1æ„æ€æ˜¯æ˜ å°„åˆ°aä¸­ç¬¬å‡ ä¸ªï¼ˆå•çº¯ä¸ºäº†æ–¹ä¾¿åè¾¹å‰ç¼€å’Œï¼Œä¸‹æ ‡åŠ 1ï¼‰
}
int main()
{cin>>n>>m;
    for(int i=0;i<n;i++)
    {
        int x,c;
        cin>>x>>c;
        add.push_back({x,c});
        alls.push_back(x);
    }
    for(int i=0;i<m;i++)
    {
        int left,right;
        cin>>left>>right;
        query.push_back({left,right});
        alls.push_back(left);
        alls.push_back(right);
        //allsæ•°ç»„å‚¨å­˜çš„æ˜¯aä¸­æ‰€æœ‰å¾…ç¦»æ•£åŒ–å€¼çš„ä¸‹æ ‡
    }
    //å»é‡
    sort(alls.begin(),alls.end());
    alls.erase(unique(alls.begin(),alls.end()),alls.end());
    //ç°åœ¨allsæ˜¯ä¸€ä¸ªæœ‰åºçš„ï¼Œæ— é‡å¤çš„å‚¨å­˜ä¸‹æ ‡çš„æ•°ç»„äº†
    //è¿™é¢˜æœ‰ç”¨çš„å°±æ˜¯allsä¸­çš„å‡ ä¸ªä¸‹æ ‡äº†ï¼Œå…¶ä»–çš„éƒ½æ²¡æœ‰ç”¨ï¼Œè¿™å‡ ä¸ªå€¼å·®è¾ƒå¤§ï¼ŒæŠŠå®ƒæŒ‰ç…§é¡ºåºæ’å¥½æ˜ å°„åˆ°aä¸Š
    //é—®é¢˜å°±è½¬åŒ–ä¸ºaæ•°ç»„çš„ç®€å•å‰ç¼€å’Œé—®é¢˜äº†ï¼Œå…³é”®æ˜¯æ˜ å°„å…¬å¼findxçš„ç†è§£ã€‚
    for(auto item:add)
    {
        int index=findx(item.first);
        a[index]+=item.second;
    }//ç¦»æ•£åŒ–å…³é”®æ­¥éª¤ï¼ŒæŠŠç¨€ç–çš„æ•°ç¦»æ•£åŒ–èšé›†åœ¨äº†aä¸Šï¼›ä¸€ä¸€æ˜ å°„
    for(int i=1;i<=alls.size();i++)
    {
        s[i]=s[i-1]+a[i];
    }
    for(auto item:query)
    {
        cout<<s[findx(item.second)]-s[findx(item.first)-1]<<endl;
    }//è®°ä½findxæ‰¾çš„æ˜¯aä¸­çš„ä¸‹æ ‡
    return 0;
}
```

1ã€**ç¦»æ•£åŒ–å°±æ˜¯å¦å¼€ä¸€ä¸ªæ•°ç»„,d**ï¼Œ d[i]ç”¨æ¥å­˜æ”¾ç¬¬iå¤§çš„æ•°åœ¨åŸåºåˆ—çš„ä»€ä¹ˆä½ç½®ï¼Œæ¯”å¦‚åŸåºåˆ—a={5ï¼Œ3ï¼Œ4ï¼Œ2ï¼Œ1}ï¼Œç¬¬ä¸€å¤§å°±æ˜¯5ï¼Œä»–åœ¨aä¸­çš„ä½æ˜¯1ï¼Œæ‰€ä»¥d[1]=1ï¼ŒåŒç†d[2]=3ï¼ŒÂ·Â·Â·Â·Â·Â·Â·Â·æ‰€ä»¥dæ•°ç»„ä¸º{1ï¼Œ3ï¼Œ2ï¼Œ4ï¼Œ5}ï¼Œ

è½¬æ¢ä¹‹åï¼Œç©ºé—´å¤æ‚åº¦å°±æ²¡è¿™ä¹ˆé«˜äº†ï¼Œä½†ä¸æ˜¯æ±‚dä¸­çš„é€†åºå¯¹äº†ï¼Œè€Œæ˜¯æ±‚dä¸­çš„æ­£åºå¯¹ï¼Œæ¥çœ‹ä¸€ä¸‹æ€ä¹ˆæ±‚çš„ï¼š

é¦–å…ˆæŠŠ1æ”¾åˆ°æ ‘çŠ¶æ•°ç»„tä¸­ï¼Œæ­¤æ—¶tåªæœ‰ä¸€ä¸ªæ•°1ï¼Œtä¸­æ¯”1å°çš„æ•°æ²¡æœ‰ï¼Œsum+=0
å†æŠŠ3æ”¾åˆ°æ ‘çŠ¶æ•°ç»„tä¸­ï¼Œæ­¤æ—¶tåªæœ‰ä¸¤ä¸ªæ•°1ï¼Œ3ï¼Œæ¯”3å°çš„æ•°åªæœ‰ä¸€ä¸ªï¼Œsum+=1
æŠŠ2æ”¾åˆ°æ ‘çŠ¶æ•°ç»„tä¸­ï¼Œæ­¤æ—¶tåªæœ‰ä¸¤ä¸ªæ•°1ï¼Œ2ï¼Œ3ï¼Œæ¯”2å°çš„æ•°åªæœ‰ä¸€ä¸ªï¼Œsum+=1
æŠŠ4æ”¾åˆ°æ ‘çŠ¶æ•°ç»„tä¸­ï¼Œæ­¤æ—¶tåªæœ‰ä¸¤ä¸ªæ•°1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œæ¯”4å°çš„æ•°æœ‰ä¸‰ä¸ªï¼Œsum+=3
æŠŠ5æ”¾åˆ°æ ‘çŠ¶æ•°ç»„tä¸­ï¼Œæ­¤æ—¶tåªæœ‰ä¸¤ä¸ªæ•°1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5ï¼Œæ¯”5å°çš„æ•°æœ‰å››ä¸ªï¼Œsum+=4

2ã€æ ¹æ®ä¸Šé¢çš„æ­¥éª¤æ¯ä¸€æ¬¡æŠŠä¸€ä¸ªæ–°çš„æ•°xæ”¾è¿›å»ä¹‹åï¼Œéƒ½è¦æ±‚æ¯”ä»–å°çš„å…ƒç´ æœ‰å‡ ä¸ªï¼Œè€Œæ¯”ä»–å°çš„å…ƒç´ ä¸ªæ•°ä¸€å®šæ˜¯1åˆ°xä¸­å­˜åœ¨æ•°çš„ä¸ªæ•°ï¼Œä¹Ÿå°±æ˜¯[1 , x-1]ä¸­æœ‰å‡ ä¸ªæ•°ï¼Œæ˜¯ä¸æ˜¯å¾ˆè€³ç†Ÿï¼Œæœ‰ç‚¹åƒä¹‹å‰è®²çš„å‰ç¼€å’Œäº†ï¼Œåªä¸è¿‡æ ‘çŠ¶æ•°ç»„tè¡¨æ˜¯çš„ä¸æ˜¯å‰ç¼€å’Œäº†ï¼Œ**t[x]è¡¨ç¤ºçš„æ˜¯[1,x]ä¸­æœ‰å‡ ä¸ªæ•°å·²ç»å­˜åœ¨**ï¼Œ<u>è¿™æ ·æˆ‘ä»¬æ¯æ¬¡æŠŠä¸€ä¸ªæ–°çš„æ•°xæ”¾è¿›å»çš„æ—¶å€™ï¼Œéƒ½éœ€è¦æŠŠåŒ…å«è¿™ä¸ªæ•°çš„ç»“ç‚¹æ›´æ–°</u>ï¼Œç„¶åæŸ¥è¯¢[1,x-1]æœ‰å‡ ä¸ªæ•°å·²ç»å­˜åœ¨ã€‚

```cpp
#include<iostream>
#include<cstdio>
#include<algorithm>
using namespace std;
int tree[500010],ranks[500010],n;
long long ans; 
struct point
{
    int num,val;
}a[500010];
inline bool cmp(point q,point w)
{
    if(q.val==w.val)
        return q.num<w.num;
    return q.val<w.val;
}
inline void insert(int p,int d)
{
    for(;p<=n;p+=p&-p)
        tree[p]+=d; 
}
inline int query(int p)
{
    int sum=0;
    for(;p;p-=p&-p)
        sum+=tree[p];
    return sum;
}
int main()
{
    scanf("%d",&n);
    for(int i=1;i<=n;i++)
        scanf("%d",&a[i].val),a[i].num=i;
    sort(a+1,a+1+n,cmp);
    for(int i=1;i<=n;i++)
        ranks[a[i].num]=i;
    for(int i=1;i<=n;i++)
    {
        insert(ranks[i],1);
        ans+=i-query(ranks[i]);
    }
    printf("%lld",ans);
    return 0;
} 
```

#### [3.2äºŒç»´ååº]()

```
é¢˜ç›®æè¿°
å†œå¤«çº¦ç¿°çš„ç‰›å‘ç°ï¼Œä»–çš„ç”°åœ°é‡Œæ²¿ç€å±±è„Šç”Ÿé•¿çš„ä¸‰å¶è‰ï¼ˆæˆ‘ä»¬å¯ä»¥å°†å…¶è§†ä¸ºä¸€ç»´æ•°å­—çº¿ï¼‰ç‰¹åˆ«å¥½ã€‚
å†œå¤«çº¦ç¿°æœ‰Nå¤´æ¯ç‰›ï¼ˆæˆ‘ä»¬å°†æ¯ç‰›çš„ç¼–å·ä»1åˆ°Nï¼‰ã€‚æ¯ä½å†œå¤«çº¦ç¿°çš„Nå¤´æ¯ç‰›éƒ½æœ‰å¥¹ç‰¹åˆ«å–œæ¬¢çš„ä¸‰å¶è‰èŒƒå›´ï¼ˆè¿™äº›èŒƒå›´å¯èƒ½é‡å ï¼‰ã€‚èŒƒå›´ç”±é—­åˆé—´éš”[Sï¼ŒE]å®šä¹‰ã€‚

ä½†æ˜¯æœ‰äº›æ¯ç‰›å¾ˆå¼ºå£®ï¼Œæœ‰äº›å´å¾ˆå¼±ã€‚ç»™å®šä¸¤ä¸ªæ¯ç‰›ï¼šæ¯ç‰›iå’Œæ¯ç‰›jï¼Œå®ƒä»¬æœ€å–œæ¬¢çš„ä¸‰å¶è‰èŒƒå›´æ˜¯[Siï¼ŒEi]å’Œ[Sjï¼ŒEj]ã€‚å¦‚æœSi <= Sjå¹¶ä¸”Ej <= Eiå¹¶ä¸”Ei-Si> Ej-Sjï¼Œæˆ‘ä»¬è¯´æ¯ç‰›iæ¯”æ¯ç‰›jå¼ºã€‚å¯¹äºæ¯å¤´æ¯ç‰›ï¼Œæœ‰å‡ å¤´æ¯ç‰›æ¯”å¥¹å¼ºï¼Ÿå†œå¤«çº¦ç¿°éœ€è¦æ‚¨çš„å¸®åŠ©ï¼

è¾“å…¥é¡¹
è¾“å…¥åŒ…å«å¤šä¸ªæµ‹è¯•ç”¨ä¾‹ã€‚
å¯¹äºæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œç¬¬ä¸€è¡Œæ˜¯æ•´æ•°Nï¼ˆ1 <= N <= 10 ^ 5ï¼‰ï¼Œå®ƒæ˜¯æ¯ç‰›çš„æ•°é‡ã€‚ç„¶åæ˜¯Nè¡Œï¼Œå…¶ç¬¬iè¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•°ï¼šSå’ŒEï¼ˆ0 <= S
è¾“å…¥çš„æœ«å°¾åŒ…å«å•ä¸ª0ã€‚

è¾“å‡ºé‡
 å¯¹äºæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œè¾“å‡ºä¸€è¡ŒåŒ…å«nä¸ªä»¥ç©ºæ ¼åˆ†éš”çš„æ•´æ•°ï¼Œå…¶ä¸­ç¬¬iä¸ªæ•°å­—æŒ‡å®šæ¯”æ¯ç‰›iå¼ºçš„æ¯ç‰›çš„æ•°é‡ã€‚

Sample Input
3
1 2
0 3
3 4
0
Sample Output
1 0 0
Hint
Huge input and output,scanf and printf is recommended.
```

> é¢˜ç›®å¤§æ„ 
> ç»™ä½ ä¸€äº›åŒºé—´ï¼Œå¯¹æ¯ä¸ªåŒºé—´è¿›è¡Œè¯¢é—®ï¼ŒæŸ¥æ‰¾æ‰€æœ‰åŒºé—´ä¸­èƒ½åŒ…å«å½“å‰åŒºé—´çš„ä¸ªæ•°ã€‚
>
> é¢˜è§£
> äºŒç»´ååºé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹åŒºé—´æŒ‰ç…§ s ä»å°åˆ°å¤§æ’åºï¼Œsç›¸ç­‰åˆ™æŒ‰ç…§ e ä»å¤§åˆ°å°æ’åºã€‚è¿™æ ·å¯ä»¥ä½¿å¾—åé¢çš„åŒºé—´çš„èµ·ç‚¹ä¸€å®šå¤§äºå‰é¢çš„ï¼Œå› æ­¤æˆ‘ä»¬å°±ä¸ç”¨è€ƒè™‘säº†ï¼Œåªéœ€è¦è€ƒè™‘eå°±è¡Œäº†ã€‚
>
> ä¹‹åæˆ‘ä»¬ç»´æŠ¤ä¸€ä¸ªæ ‘çŠ¶æ•°ç»„è®°å½•ä¸€æ®µåŒºé—´å†…å°äºå½“å‰eçš„åŒºé—´ä¸ªæ•°ï¼Œç„¶åæˆ‘ä»¬æ±‚å‡ºå·²ç»æ’å…¥æ‰€æœ‰çš„åŒºé—´ä¸ªæ•°ï¼Œå‡å»å°äºçš„ï¼Œå‰©ä¸‹çš„å°±æ˜¯å¤§äºç­‰äºå½“å‰eçš„åŒºé—´ä¸ªæ•°ã€‚
>
> **ä¸è¿‡è¿™ä¸ªé¢˜æœ‰ä¸ªtrickï¼Œå°±æ˜¯åŒºé—´ç›¸åŒçš„æƒ…å†µï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥è®°å½•ä¸‹æ¥æœ‰å¤šå°‘ä¸ªç›¸åŒçš„ï¼Œç›´æ¥ä¸€æ¬¡æ’å…¥å®Œã€‚**

```cpp
#include<iostream>
#include<algorithm>
#include<cmath>
#include<cstring>
#include<cstdio>
#include<cstdlib>
#include<vector>
#include<map>
#include<set>
#include<stack>
#include<queue>
#define PI atan(1.0)*4
#define E 2.718281828
#define rp(i,s,t) for (i = (s); i <= (t); i++)
#define RP(i,s,t) for (i = (t); i >= (s); i--)
#define ll long long
#define ull unsigned long long
#define mst(a,b) memset(a,b,sizeof(a))
#define push_back() pb()
#define fastIn                    \
    ios_base::sync_with_stdio(0); \
    cin.tie(0);
using namespace std;
inline int read()
{
    int a=0,b=1;
    char c=getchar();
    while(c<'0'||c>'9')
    {
        if(c=='-')
            b=-1;
        c=getchar();
    }
    while(c>='0'&&c<='9')
    {
        a=(a<<3)+(a<<1)+c-'0';
        c=getchar();
    }
    return a*b;
}
inline void write(int n)
{
    if(n<0)
    {
        putchar('-');
        n=-n;
    }
    if(n>=10)
        write(n/10);
    putchar(n%10+'0');
}
const int N = 1e5+7;
int c[N+2],res[N+2],n;
//ç»´æŠ¤æ ‘çŠ¶æ•°ç»„cä¸ºä¸€æ®µåŒºé—´å†…çš„å°äºå½“å‰eçš„åŒºé—´ä¸ªæ•°
//resæ•°ç»„è®°å½•è¯¢é—®çš„ç»“æœ
struct node{
    int s,e,id;
    bool operator < (const node & others){//æŒ‰ç…§sä»å°åˆ°å¤§æ’åºï¼Œè‹¥sç›¸ç­‰æŒ‰ç…§eä»å¤§åˆ°å°æ’åº
        return s==others.s?e>others.e:s<others.s;
    }
}p[N];
inline int lowbit(int x) {return x&-x;}
void update(int i,int val){//æ›´æ–°
    while(i<=N){
        c[i]+=val;
        i+=lowbit(i);
    }
}
int query(int i){//æŸ¥è¯¢
    int res=0;
    while(i>0){
        res+=c[i];
        i-=lowbit(i);
    }
    return res;
}
int main(){
    int i,j;
    while(~scanf("%d",&n)){
        if(!n) break;
        mst(c,0);
        rp(i,1,n) p[i].s=read(),p[i].e=read(),p[i].id=i;
        sort(p+1,p+1+n);
        p[0].s=-1;
        rp(i,1,n){
            int m=i,t=1;
            while(m!=n&&p[m+1].e==p[m].e&&p[m+1].s==p[m].s) t++,m++;//æ‰¾åˆ°æœ‰å¤šå°‘ä¸ªç›¸ç­‰çš„åŒºé—´
            res[p[m].id]=query(N)-query(p[i].e-1);//è®°å½•æŸ¥è¯¢ç»“æœï¼ˆå³eå¤§äºå½“å‰eçš„åŒºé—´ä¸ªæ•°ï¼‰ï¼Œå› ä¸ºæŸ¥è¯¢æ—¶æ˜¯å°äºç­‰äºçš„ï¼Œæ‰€ä»¥éœ€è¦å‡ 1 
            update(p[i].e,t);//å¾€ä¸Šæ›´æ–°æ ‘çŠ¶æ•°ç»„cï¼Œä¸è¿‡è¦è€ƒè™‘ç›¸ç­‰åŒºé—´ï¼Œç›¸å½“äºåŠ åœ¨ä¸€èµ·æ›´æ–°äº†
            for(;i<m;i++) res[p[i].id]=res[p[m].id];//æ›´æ–°ç­”æ¡ˆæ•°ç»„
        }
        rp(i,1,n-1) printf("%d ",res[i]);
        printf("%d\n",res[n]);
    }
	return 0;
}
```

#### 3.3ä¸‰ç»´ååº-é™Œä¸ŠèŠ±å¼€â­â­â­

â€‹	**é¿å…é‡å¤è®¡ç®—çš„å…³é”®**ï¼šå¯ä»¥ç”¨å½’å¹¶æ’åºæ¥ç†è§£ã€‚**é€’å½’è¿”å›åçš„åˆå¹¶**ï¼šåœ¨å¤„ç†å®Œæœ€å°å•å…ƒåï¼Œç®—æ³•å¼€å§‹åˆå¹¶è¿™äº›å•å…ƒï¼Œé€æ­¥è§£å†³è¾ƒå¤§çš„å­é—®é¢˜ã€‚æ¯æ¬¡åˆå¹¶éƒ½æ˜¯å¤„ç†ä¸åŒå­é—®é¢˜çš„ç»“æœï¼Œè€Œä¸æ˜¯é‡æ–°å¤„ç†å·²è§£å†³çš„é—®é¢˜ã€‚

> - **åŒºé—´çš„å”¯ä¸€æ€§**ï¼šåœ¨æ¯æ¬¡é€’å½’è°ƒç”¨ä¸­ï¼Œå¤„ç†çš„åŒºé—´æ˜¯å”¯ä¸€ç¡®å®šçš„ã€‚ä¾‹å¦‚ï¼Œå½“å¤„ç† `[1, 2]` å’Œ `[3, 4]` åï¼Œè¿™äº›åŒºé—´çš„ç»“æœä¼šè¢«ç”¨æ¥è§£å†³åŒ…å«å®ƒä»¬çš„æ›´å¤§åŒºé—´ `[1, 4]`ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¹¶æ²¡æœ‰é‡æ–°è®¡ç®— `[1, 2]` æˆ– `[3, 4]` å†…éƒ¨çš„ä»»ä½•ä¸œè¥¿ï¼›è€Œæ˜¯åˆ©ç”¨äº†è¿™äº›å·²å¤„ç†åŒºé—´çš„ç»“æœã€‚
> - **æ•°æ®çš„ç‹¬ç«‹æ›´æ–°**ï¼šåœ¨åˆ†æ²»æ³•ä¸­ï¼Œåˆå¹¶æ­¥éª¤æ˜¯æ ¹æ®å„ä¸ªå­åŒºé—´ç‹¬ç«‹å¾—å‡ºçš„ç»“æœæ¥æ‰§è¡Œçš„ã€‚æ¯”å¦‚åœ¨æ ‘çŠ¶æ•°ç»„ä¸­è®°å½•çš„æ˜¯ç‰¹å®šåŒºé—´å†…çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯åªåœ¨é‚£ä¸ªç‰¹å®šçš„é€’å½’å±‚æ¬¡ä¸­æœ‰æ•ˆï¼Œä¸ä¼šå½±å“åˆ°å…¶ä»–å±‚æ¬¡æˆ–å¯¼è‡´æ•°æ®å†²çªã€‚
> - **åŠŸèƒ½åˆ†éš”**ï¼šCDQ åˆ†æ²»åœ¨ä¸åŒçš„é€’å½’çº§åˆ«ä¸Šæœ‰æ¸…æ™°çš„åŠŸèƒ½åˆ†éš”ï¼Œæ¯”å¦‚æŸäº›æ“ä½œæ˜¯åœ¨å­åŒºé—´å†…éƒ¨å®Œæˆçš„ï¼Œè€ŒæŸäº›æ“ä½œæ˜¯åœ¨ä¸¤ä¸ªå­åŒºé—´åˆå¹¶æ—¶æ‰è¿›è¡Œçš„ã€‚è¿™ä¿è¯äº†æ¯ä¸ªæ“ä½œåªé’ˆå¯¹å…¶åº”è¯¥å¤„ç†çš„æ•°æ®æ‰§è¡Œä¸€æ¬¡ã€‚



> å…³äºæ•°ç»„aï¼š
>
> â‘ ã€åœ¨å¤„ç†è¾“å…¥æ•°æ®æ—¶ï¼Œ`a` æ•°ç»„ç”¨äºå­˜å‚¨å»é‡åçš„ä¸‰å…ƒç»„æ•°æ®ã€‚ç”±äºåŸå§‹è¾“å…¥å¯èƒ½åŒ…å«é‡å¤çš„ä¸‰å…ƒç»„ï¼ˆå³å®Œå…¨ç›¸åŒçš„ `x, y, z` å€¼ï¼‰ï¼Œé€šè¿‡å°†è¿™äº›é‡å¤çš„ä¸‰å…ƒç»„åˆå¹¶ä¸ºå•ä¸ªæ¡ç›®å¹¶è®°å½•å®ƒä»¬çš„å‡ºç°æ¬¡æ•°ï¼ˆæƒé‡ `w`ï¼‰ï¼Œ`a` æ•°ç»„å¯ä»¥æœ‰æ•ˆåœ°å‡å°‘åç»­å¤„ç†çš„æ•°æ®é‡ã€‚æ¯ä¸ªä¸‰å…ƒç»„åœ¨ `a` ä¸­çš„å­˜å‚¨å½¢å¼æ˜¯ä¸€ä¸ª `stnd` ç»“æ„ä½“å®ä¾‹ï¼ŒåŒ…æ‹¬åæ ‡ `(x, y, z)`ã€ä¸€ä¸ªç”¨äºç´¯ç§¯è®¡ç®—çš„ `ans` å­—æ®µï¼Œå’Œä¸€ä¸ªè¡¨ç¤ºè¯¥ç‚¹é‡å¤æ¬¡æ•°çš„ `w` å­—æ®µã€‚
>
> â‘¡ã€`a` æ•°ç»„æ˜¯ CDQ åˆ†æ²»ç®—æ³•å¤„ç†çš„ä¸»è¦æ•°æ®ç»“æ„ã€‚åˆ†æ²»ç®—æ³•é€šè¿‡é€’å½’åœ°å°† `a` æ•°ç»„åˆ†æˆå°å—æ¥å¤„ç†ä¸‰ç»´ååºé—®é¢˜ï¼Œæ¯ä¸ªåˆ†åŒºå†…éƒ¨é€šè¿‡é€’å½’è§£å†³ï¼Œè·¨åŒºé—´çš„å…³ç³»é€šè¿‡æ ‘çŠ¶æ•°ç»„è¾…åŠ©å®Œæˆã€‚åœ¨æ¯æ¬¡é€’å½’è°ƒç”¨ä¸­ï¼Œ`a` æ•°ç»„çš„ä¸€ä¸ªå­æ®µä¼šè¢«è¿›ä¸€æ­¥åˆ†è§£æˆ–æ’åºï¼Œä»¥æ”¯æŒååºè®¡æ•°çš„æœ‰æ•ˆè®¡ç®—ã€‚
>
> â‘¢ã€åœ¨ `cdq` å‡½æ•°çš„å®ç°ä¸­ï¼Œ`a` æ•°ç»„åœ¨æ¯æ¬¡é€’å½’å¤„ç†å‰åéƒ½å¯èƒ½éœ€è¦æ’åºï¼ˆåŸºäº `y` æˆ–å…¶ä»–ç»´åº¦ï¼‰ï¼Œè¿™æ˜¯ä¸ºäº†ä¼˜åŒ–åç»­çš„åˆå¹¶æ“ä½œã€‚æ’åºåçš„æ•°ç»„å…è®¸ç®—æ³•ä»¥çº¿æ€§æ–¹å¼å¤„ç†å’Œåˆå¹¶å­é—®é¢˜ï¼Œä»è€Œé™ä½é—®é¢˜çš„å¤æ‚åº¦ã€‚æ ‘çŠ¶æ•°ç»„æ“ä½œï¼ˆå¦‚ `add` å’Œ `ask`ï¼‰ä¾èµ–äº `a` æ•°ç»„ä¸­çš„ `z` å€¼ï¼Œä»¥å®ç°å¿«é€Ÿçš„ååºç»Ÿè®¡ã€‚
>
> â‘£ã€æ•°ç»„ `a` ä¸­çš„æ¯ä¸ªå…ƒç´ æœ€ç»ˆä¼šåŒ…å«ä¸€ä¸ª `ans` å­—æ®µï¼Œè¯¥å­—æ®µåœ¨ç®—æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­è¢«é€æ­¥æ›´æ–°ä»¥åæ˜ æ¯ä¸ªç‚¹åœ¨ä¸‰ç»´ç©ºé—´ä¸­çš„ååºæ’åï¼ˆå³ï¼Œæœ‰å¤šå°‘å…¶ä»–ç‚¹åœ¨æ‰€æœ‰ä¸‰ä¸ªç»´åº¦ä¸Šå‡ä¸è¶…è¿‡æ­¤ç‚¹ï¼‰ã€‚

```cpp
#include<iostream>
#include<iomanip>
#include<cstdio>
#include<cstdlib>
#include<cstring>
#include<cmath>
#include<algorithm>
#define maxn 100010
#define maxk 200010
#define ll long long 
using namespace std;
inline int read()
{
    int x=0,f=1;
    char ch=getchar();
    while(isdigit(ch)==0 && ch!='-')ch=getchar();
    if(ch=='-')f=-1,ch=getchar();
    while(isdigit(ch))x=x*10+ch-'0',ch=getchar();
    return x*f;
}
inline void write(int x)
{
    int f=0;char ch[20];
    if(!x){puts("0");return;}
    if(x<0){putchar('-');x=-x;}
    while(x)ch[++f]=x%10+'0',x/=10;
    while(f)putchar(ch[f--]);
    putchar('\n');
}
typedef struct node
{
    int x,y,z,ans,w;	//wè¡¨ç¤ºç›¸åŒä¸‰å…ƒç»„çš„ä¸ªæ•°ï¼Œa[i].ansï¼šå½“å‰ç‚¹çš„ååºæ’åï¼Œè¡¨ç¤ºæœ‰å¤šå°‘å…¶ä»–ç‚¹åœ¨ä¸‰ç»´ç©ºé—´ä¸­ä½äºå½“å‰ç‚¹çš„å‰é¢ã€‚
					  //a[i].wï¼šå½“å‰ç‚¹çš„é‡å¤æ¬¡æ•°ï¼Œè¡¨ç¤ºæœ‰å¤šå°‘ä¸ªä¸å½“å‰ç‚¹å®Œå…¨ç›¸åŒçš„ç‚¹ã€‚
}stnd;
stnd a[maxn],b[maxn];
int n,cnt[maxk];
int k,n_;
/*
é¦–å…ˆæ¯”è¾ƒğ‘¥å€¼ï¼Œè¾ƒå°çš„æ’åœ¨å‰é¢ã€‚
å¦‚æœğ‘¥å€¼ç›¸ç­‰ï¼Œåˆ™æ¯”è¾ƒğ‘¦å€¼ï¼Œè¾ƒå°çš„åŒæ ·æ’åœ¨å‰é¢ã€‚
å¦‚æœğ‘¥å’Œğ‘¦å€¼éƒ½ç›¸ç­‰ï¼Œåˆ™æ¯”è¾ƒğ‘§å€¼ã€‚
*/
bool cmpx(stnd u,stnd v)
{
    if(u.x==v.x)
    {
        if(u.y==v.y)
            return u.z<v.z;
        return u.y<v.y;
    }
    return u.x<v.x;
}
bool cmpy(stnd u,stnd v)
{
    if(u.y==v.y)
        return u.z<v.z;
    return u.y<v.y;
}
struct treearray
{
    /*
    int tre[maxk]: è¿™æ˜¯æ ‘çŠ¶æ•°ç»„æœ¬èº«ï¼Œç”¨äºå­˜å‚¨å…ƒç´ çš„éƒ¨åˆ†ç´¯è®¡å’Œã€‚
	int kk: è¡¨ç¤ºæ ‘çŠ¶æ•°ç»„çš„æœ€å¤§èŒƒå›´ï¼Œé€šå¸¸åº”è¯¥è®¾ç½®ä¸ºæ•°æ®ä¸­ z åæ ‡çš„æœ€å¤§å€¼åŠ ä¸€ã€‚*/
    int tre[maxk],kk;
    int lwbt(int x){return x&(-x);}        
    int ask(int i){                      //è¿™ä¸ªå‡½æ•°è®¡ç®—ä»æ•°ç»„èµ·å§‹åˆ°ç´¢å¼• i çš„æ‰€æœ‰å…ƒç´ çš„å’Œ
        int ans=0;               
        for(;i;i-=lwbt(i))
            ans+=tre[i];return ans;
    }
    void add(int i,int k){                       //è¿™ä¸ªå‡½æ•°ç”¨äºæ›´æ–°ç´¢å¼• i å¤„çš„å€¼ï¼Œå¢åŠ  kã€‚
        for(;i<=kk;i+=lwbt(i))
            tre[i]+=k;
    }
}t;
void cdq(int l,int r)
{
    if(l==r)return; 
    int mid=(l+r)>>1;
    cdq(l,mid);cdq(mid+1,r);        //è®¡ç®—ä¸­ç‚¹ midï¼Œå°†å½“å‰åŒºé—´ [l, r] åˆ†æˆä¸¤ä¸ªå­åŒºé—´ [l, mid] å’Œ [mid+1, r]ã€‚
                                    //å¯¹è¿™ä¸¤ä¸ªå­åŒºé—´åˆ†åˆ«é€’å½’è°ƒç”¨ cdq å‡½æ•°å¤„ç†ã€‚
    sort(a+l,a+mid+1,cmpy);
    sort(a+mid+1,a+r+1,cmpy);            //åœ¨å¤„ç†è·¨è¶Šä¸¤ä¸ªå­åŒºé—´çš„ååºå…³ç³»ä¹‹å‰ï¼Œå…ˆåˆ†åˆ«å¯¹å·¦å³ä¸¤ä¸ªå­åŒºé—´æŒ‰ç…§ y åæ ‡è¿›è¡Œæ’åº
    /*ä½¿ç”¨ä¸¤ä¸ªæŒ‡é’ˆ i å’Œ jï¼Œi éå†å³å­åŒºé—´ï¼Œj ç”¨æ¥åœ¨å·¦å­åŒºé—´ä¸­å¯»æ‰¾æ‰€æœ‰åœ¨ y å’Œ z ç»´åº¦ä¸Šä¸è¶…è¿‡ a[i] çš„ç‚¹ã€‚*/
    int i=mid+1,j=l; 
    for(;i<=r;i++)//å¤–å±‚å¾ªç¯ç§»å³åŒºé—´æŒ‡é’ˆï¼Œå†…å±‚å¾ªç¯ç§»åŠ¨å·¦åŒºé—´
    {
        /*
        iåœ¨å³åŒºé—´ï¼Œjåœ¨å·¦åŒºé—´
        å½“ a[j].y å°äºæˆ–ç­‰äº a[i].y æ—¶ï¼Œè¡¨ç¤º a[j] å¯ä»¥å¯¹ a[i] çš„ z-æ’åäº§ç”Ÿå½±å“ã€‚
t.add(a[j].z, a[j].w): åœ¨æ ‘çŠ¶æ•°ç»„ä¸­ï¼Œå°† z åæ ‡ä¸º a[j].z çš„ä½ç½®åŠ ä¸Š a[j].wï¼Œè¿™é‡Œ a[j].w è¡¨ç¤ºè¯¥ç‚¹çš„æƒé‡ï¼ˆå³ç›¸åŒç‚¹çš„æ•°é‡ï¼‰ã€‚*/
        while(a[j].y<=a[i].y && j<=mid)
            t.add(a[j].z,a[j].w),j++;         //åŠ çš„æ˜¯å·¦åŒºé—´çš„æ•°æ® 
        a[i].ans+=t.ask(a[i].z);      //t.ask(a[i].z) è¿”å›çš„æ˜¯æ‰€æœ‰ z å€¼å°äºç­‰äº a[i].z çš„ç‚¹çš„æƒé‡å’Œã€‚
								   //å°†è¿™ä¸ªå€¼åŠ åˆ° a[i].ans ä¸Šï¼Œæ›´æ–°å½“å‰ç‚¹çš„ååºæ’åã€‚
    }
    /*å¯¹äºå·²ç»æ·»åŠ åˆ°æ ‘çŠ¶æ•°ç»„å¹¶å·²ç»è¢«ç”¨äºè®¡ç®—çš„æ¯ä¸ª a[i].zï¼Œé€šè¿‡ t.add(a[i].z, -a[i].w) æŠŠå®ƒä»¬ä»æ ‘çŠ¶æ•°ç»„ä¸­å‡å»ï¼Œç›¸å½“äºæ’¤é”€ä¹‹å‰çš„æ·»åŠ æ“ä½œã€‚
è¿™æ˜¯ä¸ºäº†ä¿è¯æ ‘çŠ¶æ•°ç»„åœ¨ä¸‹ä¸€æ¬¡ä½¿ç”¨æ—¶æ˜¯å‡€ç©ºçš„ï¼Œé¿å…æ•°æ®æ±¡æŸ“ã€‚*/
    for(i=l;i<j;i++) 
        t.add(a[i].z,-a[i].w);
}
int main()
{
    n_=read(),k=read();t.kk=k;
    for(int i=1;i<=n_;i++)
        b[i].x=read(),b[i].y=read(),b[i].z=read();         //è¯»å…¥æ¯ä¸ªx,y,zçš„å€¼ 
    sort(b+1,b+n_+1,cmpx);                                 //æŒ‰ç…§xè¿›è¡Œä»å°åˆ°å¤§æ’åº
    int c=0;                        //å˜é‡ c è¢«ç”¨ä½œè®¡æ•°å™¨ï¼Œä¸»è¦ç”¨é€”æ˜¯ç»Ÿè®¡è¿ç»­ç›¸åŒçš„ä¸‰å…ƒç»„ (a_i, b_i, c_i) çš„æ•°é‡ã€‚
    int idx=0;                      //ä½œä¸ºaæ•°ç»„è¿›å¼ çš„ä¸‹æ ‡
    for(int i=1;i<=n_;i++)
    {
        c++;                                                      //è®¡æ•°ç›¸é‚»ç›¸åŒä¸‰å…ƒç»„æœ‰å‡ ä¸ª
        if(b[i].x!=b[i+1].x || b[i].y!=b[i+1].y || b[i].z!=b[i+1].z )     //ä»…å½“ç›¸é‚»ä¸‰å…ƒç»„ä¸åŒæ—¶æ‰æ‰§è¡Œä¸‹åˆ—è¯­å¥
            a[idx]=b[i],a[idx].w=c,c=0,idx++;                     //nçš„åˆå€¼ä¸ºä¸‰å…ƒç»„ä¸ªæ•°
    } 
    cdq(1,n); 	
    for(int i=1;i<=n;i++)
        cnt[a[i].ans+a[i].w-1]+=a[i].w;               //ç´¢å¼•è®¡ç®—æ ¹æ®é¢˜ç›®è¦æ±‚æ¥ï¼Œä¸ä¸€å®šæ ¹æ®è¿™ä¸ªå…¬å¼è¿›è¡Œè®¡ç®—
    for(int i=0;i<n_;i++) 
        write(cnt[i]);
    return 0;
}

```

