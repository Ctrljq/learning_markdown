---
marp: true
math: mathjax
---

# 搜索&DP BCEFHIKLVY


---


# 目录
- [B 殊途同归Ⅱ](#b-殊途同归ⅱ)
- [C 幻想时间](#c-幻想时间)
- [E 虾头卷狗莫得情感](#e-虾头卷狗莫得情感)
- [F 激流勇进](#f-激流勇进)
- [H 回忆与她皆失](#h-回忆与她皆失)
- [I 饮食计划](#i-饮食计划)
- [K 昏睡早八](#k-昏睡早八)
- [L 满身工科味的我走路上带点浮夸](#l-满身工科味的我走路上带点浮夸)
- [V 游园会](#v-游园会)
- [Y 虾头卷狗莫得情感 · 其二](#y-虾头卷狗莫得情感--其二)

---

# B 殊途同归Ⅱ
## **tag** : BFS+状压DP

---
# 题意

给了一个图以及不超过 18 个点，问在限定步数内从起点到终点的路径最多可经过的约会地点数量。

---

注意到约会地点的数据范围很小，可以使用状压记录经过约会地点的状况。

---

使用 **BFS** 得到起点和约会地点到其他位置的最短距离。

通过状压 **DP** 记录每个约会地点是否经过和最后一个经过的约会地点，并通过转移得到在该情境下的最短用时。

然后再判断每种情况下能否在限定时间内从最后一个约会地点到终点，对可行解保存经过约会地点数量的最大值（即二进制下的 1 的数量）为答案。


[Back](#目录)

---

# C 幻想时间
## **tag** : 前缀和+递推

---

# 题意

- 给一个 $n*m$ 的网格，网格上存在部分特殊点

- 求顶点和边都不覆盖特殊点，且边只能为水平/垂直/对角线方向的格点三角形（即等腰直角三角形）的数量

---

使用 $dp[i][j][k]$ 表示在 $(i,j)$ 位置向 $k$ 方向可延伸的距离，可通过记忆化搜索或者前缀和的方式遍历全图一次即可求出一个方向所有的值

然后网格上每个点将其作为直角顶点，对每个方向在直角边未接触特殊点前提下进行延伸和计数，并通过斜边顶点的 $dp[i][j][k]$ 判断斜边是否存在特殊点

提示：如果你知道如何解决两种三角形的问题，那么只要将三角形旋转 4 次，就可以得到所有解决方案

[Back](#目录)

---

# E 虾头卷狗莫得情感
## **tag** : 数位DP

---

# 题意

在 $Y$ 进制背景下给定两个数 $A$ 和 $B$

求 $[A,B]$ 中总共有多少个数满足不同位数的个数等于 $X$ 

---

由题意可知，只需关注不同数字的数量，所以状态可以简化到当前进制数 $Y$

分别求 $[0,L-1]$ 和 $[0,R]$ 中满足的数量，并将两者相减即为所求范围内答案

采用逐位遍历的方式从最高位开始依次往下，同时记录当前不同位数的个数、当前已存在的数字（可开一个数组记录）、是否存在上限限制

根据上限限制遍历当前位可取的值，并根据所选当前位的数字进行状态更新并传递给下一位

可使用记忆化搜索提速

总体时间复杂度 $O(NY)$

[Back](#目录)

---

# F 激流勇进
## **tag** : BFS+DP

---

# 题意

给一个 $n*m$ 的图，问存在多少长度至少为 $k$ 的路径满足其高度是公差为 $h$ 的等差数列

---

遍历整个图，记录每个点跟相邻点的 in  和 out 的数量

显然，只出不进的点是路径的起点

采用 BFS，在队列中初始加入所有起点，每次弹出队首的点并向相邻点更新进出状态，若存在新的只出不进的点则将其添加入队列中

状态转移为下一位的长度为 $i$ 的路径数量加上当前位的长度为 $i-1$ 的路径数量，如长度为 $k$ 则同时更新当前位长度为 $k,k-1$ 的路径数量

[Back](#目录)

---

# H 回忆与她皆失
## **tag** : 树形DP

---

# 题意

在一个二叉树上共删除 $K$ 个点，每次只能删叶子结点，求剩余结点和的最大值

---

显然，当某个点未被删除时，从根节点到这个点的路径上的所有点都必须保留，同时由题目数据范围可知根节点必被保留

使用 $dp[u][i]$ 记录 $u$ 的子树（不包括 $u$ 本身）保留 $i$ 个点，剩余的亲密度之和最大值

状态转移方程为 $dp[u][i] = \max$（左子树上保留 $i-1$ 个点+左儿子亲密度，右子树上保留 $i-1$ 个点+右儿子亲密度，左右子树共保留 $i-2$ 个点+左右儿子亲密度）

$dp[root][n-k-1]+root\_ value$ 即为所求答案

[Back](#目录)

---

# I 饮食计划
## **tag** : 背包，前缀和优化

---
# 题意

共有$m$个数，每个数的范围在 $0$ 和 $a_i$ 之间，求满足这 $m$ 个数的和为 $n$ 的方案数

---


设 $dp[i][j]$ 表示前 $i$ 个数和为 $j$ 的方案数

可得状态转移方程 $dp[i][j]=\sum_{k=0}^{a_i}dp[i-1][j-k]$

时间复杂度为 $O(nma_i)$

可使用滚动数组优化空间复杂度至 $O(n)$

**TLE on Test 28**，需进一步优化

---

使用前缀和将 $dp[i][j-a_i]$ 至 $dp[i][j-1]$ 累加，在 $O(1)$ 时间复杂度内实现

时间复杂度优化至 $O(nm)$

实测可跑进 **500ms** 

如果使用此方法仍 **TLE** ，可尝试以下策略优化：

1. 将滚动数组优化为一维数组

2. 取模操作采用加减法进行

[Back](#目录)

---

# K 昏睡早八
## **tag** : meet in the middle + 状压DP

---

# 题意

在接下来 $n$ 天总共有 $m$ 门课在早八，不能连续两天上早八，且头一天和最后一天必翘。如果翘课就会选择将同一门课全翘，同时课后花一定时间学习。问如何安排方案使课后自学时间最短


---

可以发现，相邻两天至少有一天要翘

因为 $m \le 40$ ，考虑折半，将课程分成前 $\frac{m}{2}$ 和 后 $\frac{m}{2}$ 种

枚举前半课程的翘课状况，同时根据相邻课程的种类和翘课状况判断当前状态是否合法

根据前半的选择判断后半哪些课必须要选

再判断后半的状况是否合法，使用后缀 min 的形式将可行方案预处理


---

给相邻两天的课程连边，在 $a_1$ 和 $a_n$ 连自环

问题转换为图的带权最小点覆盖，等于权值和减去最大权独立集

考虑用状压 DP ，枚举前半是否选择，对后半的状态记忆化搜索

[Back](#目录)


---


# L 满身工科味的我走路上带点浮夸
## **tag** : 概率DP，求期望

---

# 题意

某个事件完成共有 $n$ 个阶段，每个阶段都有 $p_i$ 的概率成功，若成功则进入下一阶段，反之从头开始，求完成该事件经历的阶段数期望

---

设 $dp[i]$ 为到第 $i$ 个阶段的期望

$dp[i]=(dp[i-1]+1)*p_i+(dp[i-1]+1+dp[i])*(1-p_i)$


---

设 $dp[i]$ 为到第 $i$ 个阶段的期望

$dp[i]=(dp[i-1]+1)*p_i+(dp[i-1]+1+dp[i])*(1-p_i)$

对上式进行化简后可得 $dp[i]=\frac{dp[i-1]+1}{p_i}$

[Back](#目录)

---

# V 游园会
## **tag** : 插头DP

---

# 题意

一个 $3*N$ 的矩阵，每个格点有一个权值，在固定一条路径的起点和终点分别为左上角和右下角前提下，求路径覆盖的格点的权值和的最大值

---

可以发现，在最优解中，等价于向左只移动一格就返回。

因为只有三行，往回走只能从第二行回来再从两边出去

总共有以下状态

1. 第 1 行，往下一列的第 1 行格子走

2. 第 2 行，往下一列的第 2 行格子走

3. 第 3 行，往下一列的第 3 行格子走

4. 第 1 行，走回路，从第 1 行出第 2 行回第 3 行再出

5. 第 3 行，走回路，从第 1 行出第 2 行回第 1 行再出

---

# 插头DP解法



[Back](#目录)

---

# Y 虾头卷狗莫得情感 · 其二
## **tag** : DP转移（矩阵快速幂）

---

# 题意

求满足以下条件的数组数量：
- $a.len=L$
- $A \le a[i] \le B$ 
- $\sum_{i=1}^{L}s[i] \equiv 0 \pmod{4}$

---

设 $dp[i][k]$ 表示长度为 $i$ 的数组满足模 4 为 $k$ 的数量

设 $cnt[i]$ 表示在 $[A,B]$ 范围内模 4 为 $i$ 的数的总数



可得状态转移方程为

$dp[i][k]=\sum_{x=0}^{3} dp[i-1][x]*cnt[y]$

$x+y \equiv k \pmod{4}$

可以用滚动数组降低空间复杂度，时间复杂度为$O(n)$

---

进一步的，可发现该状态转移方程等同于矩阵乘法

且每次相乘的矩阵相同

故可使用矩阵快速幂将时间复杂度降低至$O(\log n)$

[Back](#目录)

---

# Thanks for Listening!