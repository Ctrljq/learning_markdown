<!-- page_number: true -->


# <center>G 逆转摄影</center>

<br/>

### <center>By 黄霖 </center>

### <center>QQ：2649020702</center>

### <center>Blog：[空気力学の詩](https://www.cnblogs.com/cjjsb)</center>

---

# Prob

- 有$n$个人要拍照，序列$\{h_i\}$表示每个人的身高
- 有长为$n$的排列$\{p_n\}$，表示每轮拍照人们的到达顺序，同时有$q$次询问，每次询问会将$\{p_n\}$循环移位
- 一轮拍照过程会拍下$n$张照片，拍每张照片时当前到达的所有人会按照编号顺序站成一排
- 定义一张照片的权值为其中相邻两人身高差的平方和，对每轮拍照，求出其拍下的$n$张照片的权值之和
- $n\le 10^5,q\le 200$
---

# Tutorial

- 一个很trivial的想法就是按照人到达的顺序模拟拍照过程
- 用```set```维护加入一个人后的前驱和后继，这样可以很方便地计算贡献
- 但$n\times q$已经达到了$2\times 10^7$级别，再带一个$\log$显然是跑不过的
---

# Tutorial

- 此时不妨考虑题目名中潜藏的提示，把思路逆转过来——我们不再将数顺序插入而是从最终状态将数逆序删除
- 因为最终状态已知且很好计算贡献，而逆序删除的时候可以用链表来维护前驱后继，从而成功去除$\log$
- 总复杂度$O(n\times q)$
---
# <center>GL&HF</center>