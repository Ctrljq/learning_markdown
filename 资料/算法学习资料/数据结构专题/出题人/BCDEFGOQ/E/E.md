<!-- page_number: true -->


# <center>E birth of a new witch</center>

<br/>

### <center>By 黄霖 </center>

### <center>QQ：2649020702</center>

### <center>Blog：[空気力学の詩](https://www.cnblogs.com/cjjsb)</center>

---

# Prob

- 给定一个$n$个点的树，对于每个点$i\in[1,n-1]$，求出树上与$i$距离最近，且编号大于$i$的点
- $n\le 2\times  10^5$
---

# Tutorial

- 树上静态可离线的距离类问题求解，很容易想到用点分治/点分树求解(实际上点分树也可以处理动态在线的问题）
- 本题std做法采用点分树，其实就是把点分治过程中找到的重心连接成一棵新的树
- 考虑题目中给出的编号限制，处理这类偏序问题的常用技巧就是定序插入
---

# Tutorial

- 考虑按照编号从大到小依次将点激活，这样可以保证当处理到某个点时，此时点分树上所有激活的点的编号一定大于当前点
- 我们询问一个点的时候只要从这个点开始在点分树上一直向上跳，在中途的每个点处查询到子树内距离最近且已经激活的点即可
- 由于这题问的是最小距离因此也不用传统的容斥掉来自相同子树的贡献，修改也是暴力向上跳更新即可
- 实现的时候需要一个能支持快速查询原树上两点间距离的东西，用欧拉序+RMQ实现查询LCA的话总复杂度是$O(n\log n)$的，但实际上$O(n\log^2 n)$的做法也可以通过

---
# <center>GL&HF</center>