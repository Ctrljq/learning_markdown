<!-- page_number: true -->


# <center>Q CANOE</center>

<br/>

### <center>By 黄霖 </center>

### <center>QQ：2649020702</center>

### <center>Blog：[空気力学の詩](https://www.cnblogs.com/cjjsb)</center>

---

# Prob

- 给出平面内$n$个点的坐标，求欧氏距离下的第$k$远点对
- $n\le 10^5,k\le 100$，所有点的坐标在$[0,2^{31})$内等概率生成
---

# Tutorial

- KDT其实很多时候就是个强剪枝的暴力，但由于要精心构造数据才能卡所以常常可以出现大力出奇迹
- 在数据随机的情况下大致可以认为其查询复杂度是根号级别的
- 本题就是利用KDT来优化一个显而易见的暴力做法得到实测非常块的做法，当然本题还有正解旋转卡壳做法，有兴趣的同学可以自行了解
---

# Tutorial

- 首先建立KDT，对于每个节点，维护其包含的所有点中横纵坐标的最大/最小值（其实就是维护了一个最小的能覆盖所有点的矩形）
- 然后把有序点对转化为无序点对，初始时建立一个大小为$2k$的小根堆，所有元素均为$0$

- 我们不断尝试找到比当前堆顶更远的点对，如果找不到这样的点对说明堆顶就是答案
- 考虑枚举每个点$(x_i,y_i)$作为起点，在KDT上遍历求解
---
# Tutorial

- 注意一个点$(x_i,y_i)$到KDT某个节点子树内可能的最远距离就是它到该节点对应矩形的四个端点中的最大值
- 显然在遍历到某个点时，如果找到的上述可能的最远距离都小于堆顶，则可以直接剪枝，继续遍历该子树也没有任何意义
- 否则考虑在子树中遍历，一个trick是先比较左右子树中可能的最远距离，优先遍历值较大的子树可以剪去更多的枝
- 复杂度看似很爆炸（最坏达到$O(n^2)$级别），实测跑起来都是几十毫秒

---
# <center>GL&HF</center>